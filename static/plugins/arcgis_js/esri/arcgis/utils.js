// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.19/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(q,m,g){q.DeferredList=function(r,p,e,q,k){var f=[];m.call(this);var l=this;0===r.length&&!p&&this.resolve([0,[]]);var b=0;g.forEach(r,function(c,d){function h(c,a){f[d]=[c,a];b++;b===r.length&&l.resolve(f)}c.then(function(b){p?l.resolve([d,b]):h(!0,b)},function(b){e?l.reject(b):h(!1,b);if(q)return null;throw b;})})};q.DeferredList.prototype=new m;q.DeferredList.prototype.gatherResults=
function(m){m=new q.DeferredList(m,!1,!0,!1);m.addCallback(function(m){var e=[];g.forEach(m,function(g){e.push(g[1])});return e});return m};return q.DeferredList})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(q,m,g,r,p,e,s,k){q=q([e,s],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(f,l){m.mixin(this,
l);this.initialize(f,l)},getTitle:function(f){var l;this.info&&(l=this.titleHasRelatedFields?"":this._getPopupValues(f,!0).title);return l||""},getContent:function(f){return this.info?(new k({template:this,graphic:f,chartTheme:this.chartTheme},r.create("div"))).domNode:""}});g("extend-esri")&&m.setObject("dijit.PopupTemplate",q,p);return q})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),
function(q,m,g,r,p,e,s,k,f,l,b,c,d,h,t,a){q=q(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){m.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var c=this._fieldLabels={},h=this._fieldsMap={};a.fieldInfos&&g.forEach(a.fieldInfos,function(a){var n=a.fieldName.toLowerCase();c[n]=a.label;h[n]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var b;g.some(this.info&&this.info.fieldInfos,function(c){c.fieldName===a&&(b=c);return!!b});return b},getComponents:function(a){var b=this.info,c=new s,h,d;b.fieldInfos&&(d=g.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));d&&0<d.length&&(h=this._getRelatedRecords({graphic:a,fieldsInfo:d}));h?h.always(m.hitch(this,function(){c.resolve(this._getPopupValues(a))})):c.resolve(this._getPopupValues(a));
return c.promise},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_getPopupValues:function(a,b){var c=this.info,h=a.getLayer(),d=m.clone(a.attributes)||{},v=m.clone(d),x=c.fieldInfos,y="",f="",I,G,e,k,t,p=h&&h._getDateOpts&&h._getDateOpts().properties,p=p&&p.slice(0),r={dateFormat:{properties:p,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
if(this._relatedInfo)for(k in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(k)){var q=this._relatedInfo[k],s=this._relatedLayersInfo[k];q&&(g.forEach(q.relatedFeatures,function(a){for(t in a.attributes)if(a.attributes.hasOwnProperty(t)&&"esriRelCardinalityOneToOne"===s.relation.cardinality){var n=this._toRelatedFieldName([s.relation.id,t]);d[n]=v[n]=a.attributes[t]}},this),g.forEach(q.relatedStatsFeatures,function(a){for(t in a.attributes)if(a.attributes.hasOwnProperty(t)){var n=this._toRelatedFieldName([s.relation.id,
t]);d[n]=v[n]=a.attributes[t]}},this))}x&&g.forEach(x,function(a){G=a.fieldName;var n=this._getLayerFieldInfo(h,G);n&&(G=a.fieldName=n.name);v[G]=this._formatValue(v[G],G,r);p&&(a.format&&a.format.dateFormat)&&(a=g.indexOf(p,G),-1<a&&p.splice(a,1))},this);if(h){k=h.types;var z=(q=h.typeIdField)&&d[q];for(G in d)if(d.hasOwnProperty(G)&&-1===G.indexOf(this._relatedFieldPrefix)&&(e=d[G],l.isDefined(e))){var Q=this._getDomainName(h,a,k,z,G,e);l.isDefined(Q)?v[G]=Q:G===q&&(Q=this._getTypeName(h,a,e),l.isDefined(Q)&&
(v[G]=Q))}}c.title&&(y=this._processFieldsInLinks(this._fixTokens(c.title,h),d),y=m.trim(l.substitute(v,y,r)||""));if(b)return{title:y};c.description&&(f=this._processFieldsInLinks(this._fixTokens(c.description,h),d),f=m.trim(l.substitute(v,f,r)||""));x&&(I=[],g.forEach(x,function(a){(G=a.fieldName)&&a.visible&&I.push([a.label||G,l.substitute(v,"${"+G+"}",r)||""])}));var E,B;c.mediaInfos&&(E=[],g.forEach(c.mediaInfos,function(a){B=0;e=a.value;switch(a.type){case "image":var n=e.sourceURL,n=n&&m.trim(l.substitute(d,
this._fixTokens(n,h)));B=!!n;break;case "piechart":case "linechart":case "columnchart":case "barchart":var b,n=e.normalizeField;e.fields=g.map(e.fields,function(a){return(b=this._getLayerFieldInfo(h,a))?b.name:a},this);n&&(b=this._getLayerFieldInfo(h,n),e.normalizeField=b?b.name:n);B=g.some(e.fields,function(a){return l.isDefined(d[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(B){a=m.clone(a);e=a.value;var n=a.title?this._processFieldsInLinks(this._fixTokens(a.title,
h),d):"",c=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,h),d):"";a.title=n?m.trim(l.substitute(v,n,r)||""):"";a.caption=c?m.trim(l.substitute(v,c,r)||""):"";if("image"===a.type)e.sourceURL=l.substitute(d,this._fixTokens(e.sourceURL,h)),e.linkURL&&(e.linkURL=m.trim(l.substitute(d,this._fixTokens(e.linkURL,h))||""));else{var w,x;g.forEach(e.fields,function(a,n){if(-1!==a.indexOf(this._relatedFieldPrefix))x=this._getRelatedChartInfos(a,e,d,r),x instanceof Array?e.fields=x:e.fields[n]=
x;else{var b=d[a],b=void 0===b?null:b;w=d[e.normalizeField]||0;b&&w&&(b/=w);e.fields[n]={y:b,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(b,a,r,!!w)}}},this)}E.push(a)}},this));return{title:y,description:f,hasDescription:!!c.description,fields:I&&I.length?I:null,mediaInfos:E&&E.length?E:null,formatted:v,editSummary:h&&h.getEditSummary?h.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,c,h){var d,v,x,y,f,l;d=[];l=this._fromRelatedFieldName(a);f=l[0];v=this._relatedInfo[f];
f=this._relatedLayersInfo[f];v&&g.forEach(v.relatedFeatures,function(v){v=v.attributes;var f,e;for(e in v)if(v.hasOwnProperty(e)&&e===l[1]){f={};y=v[e];b.normalizeField&&(x=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?v[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);y&&x&&(y/=x);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var k=this._fromRelatedFieldName(b.tooltipField)[1];f.tooltip=v[k]&&"string"===typeof v[k]?v[k]+":\x3cbr/\x3e"+
this._formatValue(y,v[k],h,!!x):k+":\x3cbr/\x3e"+this._formatValue(y,k,h,!!x)}else f.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(y,b.tooltipField,h,!!x);else f.tooltip=y;f.y=y;d.push(f)}},this);return"esriRelCardinalityOneToMany"===f.relation.cardinality||"esriRelCardinalityManyToMany"===f.relation.cardinality?d:d[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",
dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(a,b){var c=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,n,h){a=c._getLayerFieldInfo(b,h);return"$"+(a?"{"+a.name+"}":n)})},_encodeAttributes:function(a){a=m.clone(a)||{};var b,c;for(b in a)if((c=a[b])&&"string"===typeof c)c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),a[b]=c;return a},_processFieldsInLinks:function(a,b){var c=this._encodeAttributes(b),
h=this;a&&(a=a.replace(this._reHref,function(a,n){return h._addValuesToHref(a,n,b,c)}).replace(this._reHrefApos,function(a,n){return h._addValuesToHref(a,n,b,c)}));return a},_addValuesToHref:function(a,b,c,h){b=b&&m.trim(b);return l.substitute(b&&0===b.indexOf("${")?c:h,a)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(n,b,c,h){var d=this._fieldsMap[b.toLowerCase()],v=d&&d.format;b=-1!==g.indexOf(c.dateFormat.properties,b);var x="number"===typeof n&&
!b&&(!v||!v.dateFormat);if(!l.isDefined(n)||!d||!l.isDefined(v))return x?this._forceLTR(n):n;var f="",d=[],e=v.hasOwnProperty("places")||v.hasOwnProperty("digitSeparator"),I=v.hasOwnProperty("digitSeparator")?v.digitSeparator:!0;if(e&&!b)f="NumberFormat",d.push("places: "+(l.isDefined(v.places)&&(!h||0<v.places)?Number(v.places):"Infinity")),d.length&&(f+="("+d.join(",")+")");else if(v.dateFormat)f="DateFormat"+this._insertOffset(this._dateFormats[v.dateFormat]||this._dateFormats.shortDateShortTime);
else return x?this._forceLTR(n):n;var k=this._applyFormatting(n,f,c);e&&-1<n.constructor.toString().indexOf("Array")&&(k="",g.forEach(n,m.hitch(this,function(a,b){b&&(k+=" ");k+=this._applyFormatting(a,f,c)})));e&&!I&&a.group&&(k=k.replace(RegExp("\\"+a.group,"g"),""));b&&(k='\x3cspan class\x3d"esriDateValue"\x3e'+k+"\x3c/span\x3e");return x?this._forceLTR(k):k},_applyFormatting:function(a,b,c){return l.substitute({myKey:a},"${myKey:"+b+"}",c)||""},_forceLTR:function(a){var b=k("ie");return b&&10>=
b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=l.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,c,h,d,v){return(a=a.getDomain&&a.getDomain(d,{feature:b}))&&a.codedValues?a.getName(v):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c=new s,h;this._relatedLayersInfo?this._queryRelatedLayers(b).then(m.hitch(this,
function(a){this._setRelatedRecords(b,a);c.resolve(a)}),m.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(m.hitch(this,function(a){for(h in a)a.hasOwnProperty(h)&&a[h]&&(this._relatedLayersInfo[h].relatedLayerInfo=a[h]);this._queryRelatedLayers(b).then(m.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),m.hitch(this,this._handlerErrorResponse,c))}),m.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var b=a.fieldsInfo,
h,d,e={};h=a.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});g.forEach(b,function(a){var b,n,c,d;b=this._fromRelatedFieldName(a.fieldName);n=b[0];b=b[1];n&&(this._relatedLayersInfo[n]||(g.some(h.relationships,function(a){if(a.id==n)return d=a,!0}),d&&(this._relatedLayersInfo[n]={relation:d,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[n]&&(this._relatedLayersInfo[n].relatedFields.push(b),a.statisticType&&(c=new t,c.statisticType=a.statisticType,c.onStatisticField=
b,c.outStatisticFieldName=b,this._relatedLayersInfo[n].outStatistics.push(c))))},this);for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&this._relatedLayersInfo[d]&&(a=this._relatedLayersInfo[d].relation,a=h.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[d].relatedLayerUrl=a,e[d]=c({url:a,content:{f:"json"},callbackParamName:"callback"}));return f(e)},_queryRelatedLayers:function(a){var b={},c;for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&
(b[c]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[c]}));return f(b)},_queryRelatedLayer:function(a){var b,c,e,l,v,x,y,k,I,G;b=a.graphic;c=b.getLayer().url.match(/[0-9]+$/g)[0];k=a.relatedInfo;y=k.relatedLayerInfo;I=k.relatedLayerUrl;G=k.relation;g.some(y.relationships,function(a){if(a.relatedTableId===parseInt(c,10))return e=a,!0},this);e&&(a=new d,g.some(y.fields,function(a){if(a.name===e.keyField)return v=-1!==g.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),l="string"===v?e.keyField+"\x3d'"+b.attributes[G.keyField]+"'":e.keyField+"\x3d"+b.attributes[G.keyField],a.where=l,a.outFields=k.relatedFields,k.outStatistics&&(0<k.outStatistics.length&&y.supportsStatistics)&&(x=new d,x.where=a.where,x.outFields=a.outFields,x.outStatistics=k.outStatistics),b=new h(I),l=[],l.push(b.execute(a)),x&&l.push(b.execute(x)));return f(l)},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var c in b)if(b.hasOwnProperty(c)&&
b[c]){var h=b[c];this._relatedInfo[c]={};this._relatedInfo[c].relatedFeatures=h[0].features;l.isDefined(h[1])&&(this._relatedInfo[c].relatedStatsFeatures=h[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});e("extend-esri")&&(b.PopupInfo=b.PopupInfoTemplate=
q);return q})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(q,m,g,r,p,e,s,k,f,l,b,c,d){q=q(c,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},
constructor:function(b,c){this._handler=m.hitch(this,this._handler);this._relationshipQueryHandler=m.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=m.hitch(this,this._executeForIdsHandler);this._countHandler=m.hitch(this,this._countHandler);this._extentHandler=m.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(b,c,a,n,d){var f=d.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json"},b.toJson(f&&f[0])));var e=this._handler,l=this._errorHandler;this.source&&(f={source:this.source.toJson()},
b.layer=p.toJson(f));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return k({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,n){e(b,n,c,a,d.dfd)},error:function(b){l(b,a,d.dfd)},callbackSuffix:n},this.requestOptions)},executeRelationshipQuery:function(b,c,a){b=this._encode(m.mixin({},this._url.query,{f:"json"},b.toJson()));var n=this._relationshipQueryHandler,d=this._errorHandler;this.gdbVersion&&(b.gdbVersion=this.gdbVersion);var e=new r(f._dfdCanceller);e._pendingDfd=
k({url:this._url.path+"/queryRelatedRecords",content:b,callbackParamName:"callback",load:function(b,d){n(b,d,c,a,e)},error:function(b){d(b,a,e)}},this.requestOptions);return e},executeForIds:function(b,c,a,n){var d=n.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},b.toJson(d&&d[0])));var f=this._executeForIdsHandler,e=this._errorHandler;this.source&&(d={source:this.source.toJson()},b.layer=p.toJson(d));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return k({url:this._url.path+
"/query",content:b,callbackParamName:"callback",load:function(b,d){f(b,d,c,a,n.dfd)},error:function(b){e(b,a,n.dfd)}},this.requestOptions)},executeForCount:function(b,c,a,n){var d=n.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(d&&d[0])));var f=this._countHandler,e=this._errorHandler;this.source&&(d={source:this.source.toJson()},b.layer=p.toJson(d));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return k({url:this._url.path+"/query",content:b,
callbackParamName:"callback",load:function(b,d){f(b,d,c,a,n.dfd)},error:function(b){e(b,a,n.dfd)}},this.requestOptions)},executeForExtent:function(b,c,a,n){var d=n.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(d&&d[0])));var f=this._extentHandler,e=this._errorHandler;this.source&&(d={source:this.source.toJson()},b.layer=p.toJson(d));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return k({url:this._url.path+"/query",content:b,callbackParamName:"callback",
load:function(b,d){f(b,d,c,a,n.dfd)},error:function(b){e(b,a,n.dfd)}},this.requestOptions)},_handler:function(b,c,a,n,f){try{var e=new d(b);this._successHandler([e],"onComplete",a,f)}catch(l){this._errorHandler(l,n,f)}},_relationshipQueryHandler:function(b,c,a,n,f){try{var e=b.geometryType,l=b.spatialReference,k={};g.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=e;b.spatialReference=l;b.features=a.relatedRecords;b=new d(b);if(null!=a.objectId)k[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&
"relatedRecords"!==c&&(k[a[c]]=b)});this._successHandler([k],"onExecuteRelationshipQueryComplete",a,f)}catch(v){this._errorHandler(v,n,f)}},_executeForIdsHandler:function(b,c,a,n,d){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",a,d)}catch(f){this._errorHandler(f,n,d)}},_countHandler:function(b,c,a,n,d){try{var f,e=b.features,l=b.objectIds;if(l)f=l.length;else{if(e)throw Error("Unable to perform query. Please check your parameters.");f=b.count}this._successHandler([f],"onExecuteForCountComplete",
a,d)}catch(v){this._errorHandler(v,n,d)}},_extentHandler:function(b,c,a,d,f){try{b.extent&&(b.extent=new l(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",a,f)}catch(e){this._errorHandler(e,d,f)}}});b._createWrappers(q);e("extend-esri")&&m.setObject("tasks.QueryTask",q,s);return q})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(q,m,g,r,p,e,s,k){q=q(k,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(f,e){f&&m.isString(f)&&(this._url=s.urlToObject(this.url=f));e&&e.requestOptions&&(this.requestOptions=e.requestOptions);this.normalization=!0;this._errorHandler=m.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var f=this._url,e=/^http:/i;this.url&&(this.url=this.url.replace(e,"https:"));f&&f.path&&(f.path=f.path.replace(e,"https:"))},_encode:function(f,e,b){var c,d,h={},k,a;for(k in f)if("declaredClass"!==
k&&(c=f[k],d=typeof c,null!==c&&void 0!==c&&"function"!==d))if(m.isArray(c)){h[k]=[];a=c.length;for(d=0;d<a;d++)h[k][d]=this._encode(c[d])}else"object"===d?c.toJson&&(d=c.toJson(b&&b[k]),"esri.tasks.FeatureSet"===c.declaredClass&&d.spatialReference&&(d.sr=d.spatialReference,delete d.spatialReference),h[k]=e?d:g.toJson(d)):h[k]=c;return h},_successHandler:function(f,k,b,c){k&&this[k].apply(this,f);b&&b.apply(null,f);c&&e._resDfd(c,f)},_errorHandler:function(f,e,b){this.onError(f);e&&e(f);b&&b.errback(f)},
setNormalization:function(f){this.normalization=f},onError:function(){}});r("extend-esri")&&(p.Task=q);return q})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(q,m,g,r,p,e,s,k,f,l,b){q=q(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(c){if(c){m.mixin(this,c);var d=this.features,f=c.spatialReference,
e=l.getGeometryType(c.geometryType),f=this.spatialReference=new k(f);this.geometryType=c.geometryType;c.fields&&(this.fields=c.fields);g.forEach(d,function(a,c){var k=a.geometry&&a.geometry.spatialReference;d[c]=new s(e&&a.geometry?new e(a.geometry):null,a.symbol&&b.fromJson(a.symbol),a.attributes);d[c].geometry&&!k&&d[c].geometry.setSpatialReference(f)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var d=
{};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=l.getJsonType(this.features[0].geometry)),d.features=f._encodeGraphics(this.features,b));d.exceededTransferLimit=this.exceededTransferLimit;d.transform=
this.transform;return e.fixJson(d)},_hydrate:function(){var b=this.transform,d=this.geometryType;if(b&&d)for(var f=this.features,e=b.translate[0],a=b.translate[1],n=b.scale[0],k=b.scale[1],l=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,n,f,e,h,k,l,w;d=0;for(n=a.length;d<n;d++){h=a[d];f=0;for(e=h.length;f<e;f++)k=h[f],0<f?(l+=k[0],w+=k[1]):(l=k[0],w=k[1]),k[0]=
b(l),k[1]=c(w)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,n,f,e,h;d=0;for(n=a.length;d<n;d++)f=a[d],0<d?(e+=f[0],h+=f[1]):(e=f[0],h=f[1]),f[0]=b(e),f[1]=c(h)}}(d,function(a){return a*n+e},function(b){return a-b*k}),b=0,d=f.length;b<d;b++)f[b].geometry&&l(f[b].geometry);this.transform=null},quantize:function(b){if(!this.geometryType)return this.transform=
null,this;var d=b.translate[0],f=b.translate[1],e=b.scale[0],a=b.scale[1],n=this.features,k=function(a,b,c){var d,n,f,e,h,k,l=[];d=0;for(n=a.length;d<n;d++)if(f=a[d],0<d){if(k=b(f[0]),f=c(f[1]),k!==e||f!==h)l.push([k-e,f-h]),e=k,h=f}else e=b(f[0]),h=c(f[1]),l.push([e,h]);return 0<l.length?l:null},l=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,n,f,e,h;f=a.rings||a.paths;
h=[];d=0;for(n=f.length;d<n;d++)e=f[d],(e=k(e,b,c))&&h.push(e);return 0<h.length?(a.rings?a.rings=h:a.paths=h,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=k(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-d)/e)},function(b){return Math.round((f-b)/a)}),g,m;g=0;for(m=n.length;g<m;g++)n[g].geometry&&(l(n[g].geometry)||n[g].setGeometry(null));this.transform=b;return this}});
r("extend-esri")&&m.setObject("tasks.FeatureSet",q,p);return q})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,m,g,r){q=q(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});
g("extend-esri")&&m.setObject("tasks.StatisticDefinition",q,r);return q})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(q,m,g,r,p,e,s,k,f,l,b,c,d,h,t,a,n,w,D,
u){var F=0;m=m([D,t,a],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},u.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess),r.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,c=a.length,d=this.domNode,n=this._prevMedia,f=this._nextMedia;if(1<c){var h=0,k=0;p.forEach(a,function(a){"image"===a.type?h++:-1!==a.type.indexOf("chart")&&k++});h&&(l.set(this._imageCount,"innerHTML",h),e.query(".summary .image",d).removeClass("hidden"));k&&(l.set(this._chartCount,"innerHTML",k),e.query(".summary .chart",d).removeClass("hidden"))}else e.query(".summary",
d).addClass("hidden"),b.add(n,"hidden"),b.add(f,"hidden");a=this._mediaPtr;0===a?b.add(n,"hidden"):b.remove(n,"hidden");a===c-1?b.add(f,"hidden"):b.remove(f,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],c=a.title,d=a.caption,n=e.query(".mediaSection .hzLine",this.domNode)[0];l.set(this._mediaTitle,"innerHTML",c);b[c?"remove":"add"](this._mediaTitle,"hidden");l.set(this._mediaCaption,"innerHTML",d);b[d?"remove":"add"](this._mediaCaption,"hidden");b[c&&
d?"remove":"add"](n,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var f=this,c=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],d=a.value.theme||this.chartTheme;r.isString(d)&&(d=d.replace(/\./gi,"/"),-1===d.indexOf("/")&&(d="dojox/charting/themes/"+d));d||(d="./Rainbow");c.push(d);try{var h=this._rid=F++;q(c,function(b,c,d){h===f._rid&&(f._rid=null,f._showChart(a.type,a.value,b,c,d))})}catch(k){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&r.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){b.add(this._mediaFrame,"image");var n=d.get(this._gallery,"height"),f;a.linkURL&&(f=c.create("a",{href:a.linkURL,target:this._preventNewTab(a.linkURL)?"":"_blank"},this._mediaFrame));c.create("img",{className:"esriPopupMediaImage",src:a.sourceURL},f||this._mediaFrame);var h=e.query(".esriPopupMediaImage",this._mediaFrame)[0],k=this,l;l=g.connect(h,"onload",function(){g.disconnect(l);l=null;k._imageLoaded(h,
n)})},_showChart:function(a,d,n,f,h){b.remove(this._mediaFrame,"image");n=this._chart=new n(c.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});h&&n.setTheme(h);switch(a){case "piechart":n.addPlot("default",{type:"Pie",labels:!1});n.addSeries("Series A",d.fields);break;case "linechart":n.addPlot("default",{type:"Markers"});n.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});n.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});p.forEach(d.fields,
function(a,b){a.x=b+1});n.addSeries("Series A",d.fields);break;case "columnchart":n.addPlot("default",{type:"Columns",gap:3});n.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});n.addSeries("Series A",d.fields);break;case "barchart":n.addPlot("default",{type:"Bars",gap:3}),n.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),n.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),n.addSeries("Series A",d.fields)}this._action=new f(n);n.render()},
_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);l.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),d.set(a,"marginTop",c+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var c="";!(b instanceof Error)&&(b&&b.length)&&p.forEach(b,function(a){c+="\x3cli\x3e";c+="\x3ca href\x3d'"+w.addProxy(a.url)+"' target\x3d'_blank'\x3e"+
(a.name||"[No name]")+"\x3c/a\x3e";c+="\x3c/li\x3e"});l.set(this._attachmentsList,"innerHTML",c||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(a){if(a){var c=this.showTitle?a.title:"",d=a.description,n=a.fields,k=a.mediaInfos,w=this.domNode,g=this._nls,D=this,m=this.template,u=this.graphic;this._prevMedia.title=g.NLS_prevMedia;this._nextMedia.title=g.NLS_nextMedia;l.set(this._title,"innerHTML",c);c||b.add(this._title,"hidden");!a.hasDescription&&n&&(d="",p.forEach(n,
function(a){d+="\x3ctr valign\x3d'top'\x3e";d+="\x3ctd class\x3d'attrName'\x3e"+h.encode(a[0])+"\x3c/td\x3e";d+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+g.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";d+="\x3c/tr\x3e"}),d&&(d="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+d+"\x3c/table\x3e"));l.set(this._description,"innerHTML",d);d||b.add(this._description,"hidden");e.query("a",
this._description).forEach(function(a){D._preventNewTab(a.href)?"_blank"===a.target&&l.remove(a,"target"):l.set(a,"target","_blank")});c&&d?e.query(".mainSection .hzLine",w).removeClass("hidden"):c||d?e.query(".mainSection .hzLine",w).addClass("hidden"):e.query(".mainSection",w).addClass("hidden");if(c=this._dfd=m.getAttachments(u))c.addBoth(r.hitch(this,this._attListHandler,c)),l.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+g.NLS_searching+"...\x3c/li\x3e"),e.query(".attachmentsSection",w).removeClass("hidden");
k&&k.length&&(e.query(".mediaSection",w).removeClass("hidden"),f.setSelectable(this._mediaFrame,!1),this._mediaInfos=k,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(l.set(this._editSummary,"innerHTML",a.editSummary),k&&k.length&&b.remove(this._mediaBreak,"hidden"),b.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});s("extend-esri")&&r.setObject("dijit._PopupRenderer",m,n);return m})},
"dojox/html/entities":function(){define(["dojo/_base/lang"],function(q){var m=q.getObject("dojox.html.entities",!0),g=function(g,e){var m,k;if(e._encCache&&e._encCache.regexp&&e._encCache.mapper&&e.length==e._encCache.length)m=e._encCache.mapper,k=e._encCache.regexp;else{m={};k=["["];var f;for(f=0;f<e.length;f++)m[e[f][0]]="\x26"+e[f][1]+";",k.push(e[f][0]);k.push("]");k=RegExp(k.join(""),"g");e._encCache={mapper:m,regexp:k,length:e.length}}return g=g.replace(k,function(f){return m[f]})},r=function(g,
e){var m,k;if(e._decCache&&e._decCache.regexp&&e._decCache.mapper&&e.length==e._decCache.length)m=e._decCache.mapper,k=e._decCache.regexp;else{m={};k=["("];var f;for(f=0;f<e.length;f++){var l="\x26"+e[f][1]+";";f&&k.push("|");m[l]=e[f][0];k.push(l)}k.push(")");k=RegExp(k.join(""),"g");e._decCache={mapper:m,regexp:k,length:e.length}}return g=g.replace(k,function(b){return m[b]})};m.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2",
"cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],
["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],
["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1",
"ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],
["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],
["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],
["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],
["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665",
"hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039",
"lsaquo"],["\u203a","rsaquo"]];m.encode=function(p,e){p&&(e?p=g(p,e):(p=g(p,m.html),p=g(p,m.latin)));return p};m.decode=function(g,e){g&&(e?g=r(g,e):(g=r(g,m.html),g=r(g,m.latin)));return g};return m})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(q,m,g,r,p,e,s,k,f,l,b,c,d){function h(){}
function t(a){return function(b,c,d,f){return b&&"string"==typeof c&&b[c]==h?b.on(c.substring(2).toLowerCase(),s.hitch(d,f)):a.apply(g,arguments)}}q.around(g,"connect",t);e.connect&&q.around(e,"connect",t);q=r("dijit._Widget",[b,c,d],{onClick:h,onDblClick:h,onKeyDown:h,onKeyPress:h,onKeyUp:h,onMouseDown:h,onMouseMove:h,onMouseOut:h,onMouseOver:h,onMouseLeave:h,onMouseEnter:h,onMouseUp:h,constructor:function(a){this._toConnect={};for(var b in a)this[b]===h&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=
a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===h?g.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){e.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,b)},attr:function(a,
b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){e.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?k("[widgetId]",this.containerNode).map(l.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});p("dijit-legacy-requires")&&f(0,function(){require(["dijit/_base"])});return q})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(q,m,g,r,p,e,s,k,f,l,b,c,d,h,t,a,n,w,D,u,F,v,x){function y(a){return function(b){k[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}d.add("dijit-legacy-requires",!h.isAsync);d.add("dojo-bidi",!1);d("dijit-legacy-requires")&&n(0,function(){q(["dijit/_base/manager"])});var H={};r=e("dijit._WidgetBase",[w,F],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:y("lang"),dir:"",_setDirAttr:y("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:r.blankGif||q.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+
d.substr(5,d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=s.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&(this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id)&&(this.id=this.srcNodeRef.id);a&&(this.params=a,t.mixin(this,a));this.postMixInProperties();this.id||(this.id=x.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);
this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=u.body(this.ownerDocument);x.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&(d.parentNode&&this.domNode!==d)&&(d.parentNode.replaceChild(this.domNode,d),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||
{})a[b]=this._get(b);m.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(m.map(a,function(a){return a+"Rtl"})));f.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||
(this._started=!0,m.forEach(this.getChildren(),function(a){!a._started&&(!a._destroyed&&t.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();m.forEach(this._connects,t.hitch(this,"disconnect"));m.forEach(this._supportingWidgets,b);this.domNode&&m.forEach(x.findWidgets(this.domNode,
this.containerNode),b);this.destroyRendering(a);x.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?k.remove(this.domNode,"widgetId"):l.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||l.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){m.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=
this.domNode;t.isObject(a)?c.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,b,c){c=3<=arguments.length?c:this.attributeMap[a];m.forEach(t.isArray(c)?c:[c],function(c){var d=this[c.node||c||"domNode"];switch(c.type||"attribute"){case "attribute":t.isFunction(b)&&(b=t.hitch(this,b));c=c.attribute?c.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;d.tagName?k.set(d,c,b):d.set(c,b);break;case "innerText":d.innerHTML="";d.appendChild(this.ownerDocument.createTextNode(b));
break;case "innerHTML":d.innerHTML=b;break;case "class":f.replace(d,b,this[a]);break;case "toggleClass":f.toggle(d,c.className||a,b)}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(t.isFunction(d))var n=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!t.isFunction(this.focusNode)?"focusNode":
"domNode",f=this[d]&&this[d].tagName,h;if(h=f)if(!(h=H[f])){h=this[d];var e={},k;for(k in h)e[k.toLowerCase()]=!0;h=H[f]=e}k=h;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:k&&c.l in k&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return n||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});
return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(b,c,d){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var n,f=this["on"+b];f&&(n=f.apply(this,
d?d:[c]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,b.toLowerCase(),c);return n},on:function(b,c){var d=this._onMap(b);return d?g.after(this,d,c,!0):this.own(a(this.domNode,b,c))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?
x.findWidgets(this.containerNode):[]},getParent:function(){return x.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(p.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(D.subscribe(a,t.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():b.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=c.get(this.domNode,"display")},
placeAt:function(a,b){var c=!a.tagName&&x.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c&&"domNode"in c?c.containerNode&&!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:s.byId(a,this.ownerDocument),l.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(t.hitch(this,function(){c&&(c=null,this._destroyed||t.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),
c=null);return null}}}});d("dojo-bidi")&&r.extend(v);return r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(q,m,g){return g("dijit.Destroyable",null,{destroy:function(g){this._destroyed=!0},own:function(){var g=["destroyRecursive","destroy","remove"];q.forEach(arguments,function(p){function e(){k.remove();q.forEach(f,function(f){f.remove()})}var s,k=m.before(this,"destroy",function(f){p[s](f)}),f=[];p.then?(s="cancel",p.then(e,e)):q.forEach(g,
function(k){"function"===typeof p[k]&&(s||(s=k),f.push(m.after(p,k,e,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(q,m,g,r,p,e){q=r("dijit._OnDijitClickMixin",null,{connect:function(g,k,f){return this.inherited(arguments,[g,"ondijitclick"==k?e:k,f])}});q.a11yclick=e;return q})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],
function(q,m,g,r){r.extend(m,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return g("dijit._FocusMixin",null,{_focusManager:q})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(q,m,g,r){g(function(){m("highcontrast")&&q.add(r.body(),"dijit_a11y")});return m})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(q,m,g,r,p,e,s){p.add("highcontrast",function(){var e=s.doc.createElement("div");try{e.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(m.blankGif||q.toUrl("./resources/blank.gif"))+'");';s.body().appendChild(e);var f=r.getComputedStyle(e),l=f.backgroundImage;return f.borderTopColor==f.borderRightColor||l&&("none"==l||"url(invalid-url:)"==l)}catch(b){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
b.toString()),!1}finally{8>=p("ie")?e.outerHTML="":s.body().removeChild(e)}});e(function(){p("highcontrast")&&g.add(s.body(),"dj_a11y")});return p})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(q,m,g,r,p,e,s){e.extend(q,{waiRole:"",waiState:""});return p("dijit._Templated",[m,g],{constructor:function(){s.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(e,f){var l=this.inherited(arguments),b=f(e,"waiRole");b&&e.setAttribute("role",b);(b=f(e,"waiState"))&&r.forEach(b.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),e.setAttribute("aria-"+b[0],b[1]))});return l}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(q,m,g,r,p,e,s,k){var f=m("dijit._TemplatedMixin",k,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(f){var b=this.declaredClass,c=this;return s.substitute(f,this,function(d,f){"!"==f.charAt(0)&&(d=r.getObject(f.substr(1),!1,c));if("undefined"==typeof d)throw Error(b+" template:"+f);return null==d?"":"!"==f.charAt(0)?d:this._escapeValue(""+d)},this)},_escapeValue:function(f){return f.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=q(this.templatePath,{sanitize:!0}));var e=f.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),b;if(r.isString(e)){if(b=g.toDom(this._stringRepl(e),this.ownerDocument),1!=b.nodeType)throw Error("Invalid template: "+e);}else b=e.cloneNode(!0);this.domNode=b}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(f){var b=this.containerNode;if(f&&b)for(;f.hasChildNodes();)b.appendChild(f.firstChild)}});
f._templateCache={};f.getCachedTemplate=function(e,b,c){var d=f._templateCache,h=e,k=d[h];if(k){try{if(!k.ownerDocument||k.ownerDocument==(c||document))return k}catch(a){}g.destroy(k)}e=s.trim(e);if(b||e.match(/\$\{([^\}]+)\}/g))return d[h]=e;b=g.toDom(e,c);if(1!=b.nodeType)throw Error("Invalid template: "+e);return d[h]=b};e("ie")&&p(window,"unload",function(){var e=f._templateCache,b;for(b in e){var c=e[b];"object"==typeof c&&g.destroy(c);delete e[b]}});return f})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(q){return q.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(q,m,g,r,p,e,s,k,f){var l=p.delegate(k,{mouseenter:e.enter,mouseleave:e.leave,keypress:g._keypress}),b;g=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var d=b;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(b,c){return b.getAttribute(c)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==b)break;for(;!d.nextSibling;)if(d=d.parentNode,d==b)return;d=d.nextSibling}},_processTemplateNode:function(b,d,f){var e=!0,a=this.attachScope||this,n=d(b,"dojoAttachPoint")||d(b,"data-dojo-attach-point");if(n)for(var k=n.split(/\s*,\s*/);n=
k.shift();)p.isArray(a[n])?a[n].push(b):a[n]=b,e="containerNode"!=n,this._attachPoints.push(n);if(d=d(b,"dojoAttachEvent")||d(b,"data-dojo-attach-event")){n=d.split(/\s*,\s*/);for(k=p.trim;d=n.shift();)if(d){var g=null;-1!=d.indexOf(":")?(g=d.split(":"),d=k(g[0]),g=k(g[1])):d=k(d);g||(g=d);this._attachEvents.push(f(b,d,p.hitch(a,g)))}}return e},_attach:function(c,d,f){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?b||(b=q("./a11yclick")):l[d]||d;return s(c,d,f)},_detachTemplateNodes:function(){var b=
this.attachScope||this;m.forEach(this._attachPoints,function(d){delete b[d]});this._attachPoints=[];m.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});p.extend(f,{dojoAttachEvent:"",dojoAttachPoint:""});return g})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(q,m,g,r,p){return g("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var e=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);p.parse(e,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(e){this._startupWidgets=e;for(var k=0;k<e.length;k++)this._processTemplateNode(e[k],
function(f,e){return f[e]},function(f,e,b){return e in f?f.connect(f,e,b):f.on(e,b,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(e,g,k){return g(e,"dojoType")||g(e,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){q.forEach(this._startupWidgets,function(e){e&&(!e._started&&e.startup)&&e.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(q,m,g,r,p,e,s,k,f,l,b,c,d,h,t,a){function n(a){return eval("("+a+")")}function w(a){var b=
a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<u){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=u}return b}function D(a,b){b||(b=q);var c=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),d=a.join();if(!c[d]){for(var n=[],f=0,e=a.length;f<e;f++){var h=a[f];n[n.length]=c[h]=c[h]||g.getObject(h)||~h.indexOf("/")&&b(h)}f=n.shift();c[d]=n.length?f.createSubclass?f.createSubclass(n):f.extend.apply(f,n):f}return c[d]}new Date("X");var u=0;f.after(g,"extend",
function(){u++},!0);var F={_clearCache:function(){u++;_ctorMap={}},_functionFromScript:function(a,b){var c="",d="",f=a.getAttribute(b+"args")||a.getAttribute("args"),n=a.getAttribute("with"),f=(f||"").split(/\s*,\s*/);n&&n.length&&r.forEach(n.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(f,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||m._scopeName)+"Type",f="data-"+(c.scope||m._scopeName)+"-",n=f+"type",e=f+"mixins",h=[];r.forEach(a,function(a){var c=
d in b?b[d]:a.getAttribute(n)||a.getAttribute(d);if(c){var f=a.getAttribute(e),c=f?[c].concat(f.split(/\s*,\s*/)):[c];h.push({node:a,types:c})}});return this._instantiate(h,b,c)},_instantiate:function(a,b,c,d){function f(a){!b._started&&!c.noStart&&r.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=r.map(a,function(a){var d=a.ctor||D(a.types,c.contextRequire);if(!d)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(d,
a.node,b,c,a.scripts,a.inherited)},this);return d?l(a).then(f):f(a)},construct:function(a,c,e,l,D,u){function p(a){Q&&g.setObject(Q,a);for(A=0;A<O.length;A++)f[O[A].advice||"after"](a,O[A].method,g.hitch(a,O[A].func),!0);for(A=0;A<R.length;A++)R[A].call(a);for(A=0;A<U.length;A++)a.watch(U[A].prop,U[A].func);for(A=0;A<L.length;A++)t(a,L[A].event,L[A].func);return a}var F=a&&a.prototype;l=l||{};var q={};l.defaults&&g.mixin(q,l.defaults);u&&g.mixin(q,u);var s;d("dom-attributes-explicit")?s=c.attributes:
d("dom-attributes-specified-flag")?s=r.filter(c.attributes,function(a){return a.specified}):(u=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),s=r.map(u.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==c.nodeName&&"value"==a||"enctype"==b?c.getAttribute(b):c.getAttributeNode(b).value}}));var P=l.scope||m._scopeName;u="data-"+P+"-";var C={};"dojo"!==P&&(C[u+"props"]=
"data-dojo-props",C[u+"type"]="data-dojo-type",C[u+"mixins"]="data-dojo-mixins",C[P+"type"]="dojotype",C[u+"id"]="data-dojo-id");for(var A=0,z,P=[],Q,E;z=s[A++];){var B=z.name,J=B.toLowerCase();z=z.value;switch(C[J]||J){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":E=z;break;case "data-dojo-id":case "jsid":Q=z;break;case "data-dojo-attach-point":case "dojoattachpoint":q.dojoAttachPoint=z;break;case "data-dojo-attach-event":case "dojoattachevent":q.dojoAttachEvent=
z;break;case "class":q["class"]=c.className;break;case "style":q.style=c.style&&c.style.cssText;break;default:if(B in F||(B=w(a)[J]||B),B in F)switch(typeof F[B]){case "string":q[B]=z;break;case "number":q[B]=z.length?Number(z):NaN;break;case "boolean":q[B]="false"!=z.toLowerCase();break;case "function":""===z||-1!=z.search(/[^\w\.]+/i)?q[B]=new Function(z):q[B]=g.getObject(z,!1)||new Function(z);P.push(B);break;default:J=F[B],q[B]=J&&"length"in J?z?z.split(/\s*,\s*/):[]:J instanceof Date?""==z?new Date(""):
"now"==z?new Date:b.fromISOString(z):J instanceof k?m.baseUrl+z:n(z)}else q[B]=z}}for(s=0;s<P.length;s++)C=P[s].toLowerCase(),c.removeAttribute(C),c[C]=null;if(E)try{E=n.call(l.propsThis,"{"+E+"}"),g.mixin(q,E)}catch(T){throw Error(T.toString()+" in data-dojo-props\x3d'"+E+"'");}g.mixin(q,e);D||(D=a&&(a._noScript||F._noScript)?[]:h("\x3e script[type^\x3d'dojo/']",c));var O=[],R=[],U=[],L=[];if(D)for(A=0;A<D.length;A++)C=D[A],c.removeChild(C),e=C.getAttribute(u+"event")||C.getAttribute("event"),l=
C.getAttribute(u+"prop"),E=C.getAttribute(u+"method"),P=C.getAttribute(u+"advice"),s=C.getAttribute("type"),C=this._functionFromScript(C,u),e?"dojo/connect"==s?O.push({method:e,func:C}):"dojo/on"==s?L.push({event:e,func:C}):q[e]=C:"dojo/aspect"==s?O.push({method:E,advice:P,func:C}):"dojo/watch"==s?U.push({prop:l,func:C}):R.push(C);a=(D=a.markupFactory||F.markupFactory)?D(q,c,a):new a(q,c);return a.then?a.then(p):p(a)},scan:function(a,b){function f(a){if(!a.inherited){a.inherited={};var b=a.node,c=
f(a.parent),b={dir:b.getAttribute("dir")||c.dir,lang:b.getAttribute("lang")||c.lang,textDir:b.getAttribute(w)||c.textDir},d;for(d in b)b[d]&&(a.inherited[d]=b[d])}return a.inherited}var n=[],e=[],h={},k=(b.scope||m._scopeName)+"Type",g="data-"+(b.scope||m._scopeName)+"-",l=g+"type",w=g+"textdir",g=g+"mixins",u=a.firstChild,p=b.inherited;if(!p){var t=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&t(a.parentNode,b)},p={dir:t(a,"dir"),lang:t(a,"lang"),textDir:t(a,w)},F;for(F in p)p[F]||
delete p[F]}for(var p={inherited:p},s,E;;)if(u)if(1!=u.nodeType)u=u.nextSibling;else if(s&&"script"==u.nodeName.toLowerCase())(B=u.getAttribute("type"))&&/^dojo\/\w/i.test(B)&&s.push(u),u=u.nextSibling;else if(E)u=u.nextSibling;else{var B=u.getAttribute(l)||u.getAttribute(k);F=u.firstChild;if(!B&&(!F||3==F.nodeType&&!F.nextSibling))u=u.nextSibling;else{E=null;if(B){var J=u.getAttribute(g);s=J?[B].concat(J.split(/\s*,\s*/)):[B];try{E=D(s,b.contextRequire)}catch(T){}E||r.forEach(s,function(a){~a.indexOf("/")&&
!h[a]&&(h[a]=!0,e[e.length]=a)});J=E&&!E.prototype._noScript?[]:null;p={types:s,ctor:E,parent:p,node:u,scripts:J};p.inherited=f(p);n.push(p)}else p={node:u,scripts:s,parent:p};s=J;E=u.stopParser||E&&E.prototype.stopParser&&!b.template;u=F}}else{if(!p||!p.node)break;u=p.node.nextSibling;E=!1;p=p.parent;s=p.scripts}var O=new c;e.length?(d("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+e.join(", ")),(b.contextRequire||q)(e,function(){O.resolve(r.filter(n,function(a){if(!a.ctor)try{a.ctor=
D(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var f=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(f&&f.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):O.resolve(n);return O.promise},_require:function(a,b){var d=n("{"+a.innerHTML+"}"),f=[],e=[],h=new c,k=b&&b.contextRequire||q,l;for(l in d)f.push(l),e.push(d[l]);k(e,function(){for(var a=0;a<f.length;a++)g.setObject(f[a],arguments[a]);h.resolve(arguments)});
return h.promise},_scanAmd:function(a,b){var d=new c,f=d.promise;d.resolve(!0);var n=this;h("script[type\x3d'dojo/require']",a).forEach(function(a){f=f.then(function(){return n._require(a,b)});a.parentNode.removeChild(a)});return f},parse:function(a,b){a&&("string"!=typeof a&&!("nodeType"in a))&&(b=a,a=b.rootNode);var c=a?e.byId(a):s.body();b=b||{};var d=b.template?{template:!0}:{},f=[],n=this,h=this._scanAmd(c,b).then(function(){return n.scan(c,b)}).then(function(a){return n._instantiate(a,d,b,!0)}).then(function(a){return f=
f.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});g.mixin(f,h);return f}};m.parser=F;p.parseOnLoad&&a(100,F,"parse");return F})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(q,m){var g={};q.setObject("dojo.date.stamp",g);g.fromISOString=function(q,p){g._isoRegExp||(g._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var e=g._isoRegExp.exec(q),s=null;
if(e){e.shift();e[1]&&e[1]--;e[6]&&(e[6]*=1E3);p&&(p=new Date(p),m.forEach(m.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(f){return p["get"+f]()}),function(f,b){e[b]=e[b]||f}));s=new Date(e[0]||1970,e[1]||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0);100>e[0]&&s.setFullYear(e[0]||1970);var k=0,f=e[7]&&e[7].charAt(0);"Z"!=f&&(k=60*(e[8]||0)+(Number(e[9])||0),"-"!=f&&(k*=-1));f&&(k-=s.getTimezoneOffset());k&&s.setTime(s.getTime()+6E4*k)}return s};g.toISOString=function(g,
m){var e=function(b){return 10>b?"0"+b:b};m=m||{};var q=[],k=m.zulu?"getUTC":"get",f="";"time"!=m.selector&&(f=g[k+"FullYear"](),f=["0000".substr((f+"").length)+f,e(g[k+"Month"]()+1),e(g[k+"Date"]())].join("-"));q.push(f);if("date"!=m.selector){f=[e(g[k+"Hours"]()),e(g[k+"Minutes"]()),e(g[k+"Seconds"]())].join(":");k=g[k+"Milliseconds"]();m.milliseconds&&(f+="."+(100>k?"0":"")+e(k));if(m.zulu)f+="Z";else if("time"!=m.selector)var k=g.getTimezoneOffset(),l=Math.abs(k),f=f+((0<k?"-":"+")+e(Math.floor(l/
60))+":"+e(l%60));q.push(f)}return q.join("T")};return g})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(q,m,g,r,p,e){return q([e,p],{_onMap:function(e){var k=this.constructor._onMap,f;if(!k||!k.FINAL)delete this.constructor._onMap,k=this.registerConnectEvents(),k.FINAL=!0;e=e.toLowerCase();k[e]?f=this[k[e].method]:(e=this._onCamelCase(e),this[e]&&(f=e));return f},on:function(e,k){var f=this._onMap(e),
g=e.replace(/\-/g,""),b="on"+g in this.domNode;return f||!b?this.inherited(arguments):this.own(r(this.domNode,g,k))[0]},emit:function(e,k,f){var g,b,c,d=e.toLowerCase(),h=this.constructor._onMap||this.registerConnectEvents();b=this[this._onMap(d)];k=k||{};k.target||(k.target=this);b&&(h&&h[d])&&(this._onObj2Arr(function(){g=Array.prototype.slice.call(arguments)},h[d].argKeys)(k),c=m.mixin({},arguments),c[2]=g,c[0]=h[d].name.replace(/^on/,""));return this.inherited(c||arguments)}})})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(q,m,g,r,p,e,s,k,f,l,b,c,d,h,t){q=q(l,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=m.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());
return{geometryType:t.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var d=t.getGeometryType(b);a=a.geometries;var f=[],e={spatialReference:c.toJson()},h=m.mixin;g.forEach(a,function(a,b){f[b]=new d(h(a,e))});return f},_toProjectGeometry:function(a){var f=a.spatialReference.toJson();return a instanceof b?new d({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:f}):new c({paths:[[].concat(a.points)],spatialReference:f})},
_fromProjectedGeometry:function(a,c,d){return"esriGeometryEnvelope"===c?(a=a.rings[0],new b(a[0][0],a[0][1],a[2][0],a[2][1],d)):new h({points:a.paths[0],spatialReference:d.toJson()})},project:function(a,b,c,d){var e=m.mixin({},this._url.query,{f:"json"}),h;a.geometries?(d=c,c=b,b=a.outSR,h=a.geometries[0],e=m.mixin(e,a.toJson())):(h=a[0],e=m.mixin(e,{outSR:b.wkid||r.toJson(b.toJson()),inSR:h.spatialReference.wkid||r.toJson(h.spatialReference.toJson()),geometries:r.toJson(this._encodeGeometries(a))}));
var g=t.getJsonType(h),l=this._projectHandler,q=this._errorHandler,s=new p(f._dfdCanceller);s._pendingDfd=k({url:this._url.path+"/project",content:e,callbackParamName:"callback",load:function(a,f){l(a,f,g,b,c,d,s)},error:function(a){q(a,d,s)}});return s},_projectHandler:function(a,b,c,d,f,e,h){try{var k=this._decodeGeometries(a,c,d);this._successHandler([k],"onProjectComplete",f,h)}catch(g){this._errorHandler(g,e,h)}},onProjectComplete:function(){},simplify:function(a,b,c){var d=a[0].spatialReference,
e=m.mixin({},this._url.query,{f:"json",sr:d.wkid?d.wkid:r.toJson(d.toJson()),geometries:r.toJson(this._encodeGeometries(a))}),h=t.getJsonType(a[0]),g=this._simplifyHandler,l=this._errorHandler,q=new p(f._dfdCanceller);q._pendingDfd=k({url:this._url.path+"/simplify",content:e,callbackParamName:"callback",load:function(a,f){g(a,f,h,d,b,c,q)},error:function(a){l(a,c,q)}});return q},_simplifyHandler:function(a,b,c,d,f,e,h){try{var k=this._decodeGeometries(a,c,d);this._successHandler([k],"onSimplifyComplete",
f,h)}catch(g){this._errorHandler(g,e,h)}},onSimplifyComplete:function(){},convexHull:function(a,b,c){var d=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(d.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var e=this._convexHullHandler,h=this._errorHandler,g=new p(f._dfdCanceller);g._pendingDfd=k({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,f){e(a,f,d,b,c,g)},error:function(a){h(a,c,g)}});return g},_convexHullHandler:function(a,
b,c,d,f,e){try{var h=t.fromJson(a.geometry).setSpatialReference(c);this._successHandler([h],"onConvexHullComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onConvexHullComplete:function(){},union:function(a,b,c){var d=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(d.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var e=this._unionHandler,h=this._errorHandler,g=new p(f._dfdCanceller);g._pendingDfd=k({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(a,f){e(a,f,d,b,c,g)},error:function(a){h(a,c,g)}});return g},_unionHandler:function(a,b,c,d,f,e){try{var h=t.fromJson(a.geometry).setSpatialReference(c);this._successHandler([h],"onUnionComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onUnionComplete:function(){},autoComplete:function(a,b,c,d){var e=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),polygons:r.toJson(this._encodeGeometries(a).geometries),polylines:r.toJson(this._encodeGeometries(b).geometries)});
var h=this._autoCompleteHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,e,c,d,l)},error:function(a){g(a,d,l)}});return l},_autoCompleteHandler:function(a,b,c,f,e,h){try{var k=a.geometries;a=[];var g,l=k.length;for(g=0;g<l;g++)a[g]=new d({spatialReference:c,rings:k[g].rings});this._successHandler([a],"onAutoCompleteComplete",f,h)}catch(m){this._errorHandler(m,e,h)}},onAutoCompleteComplete:function(){},
reshape:function(a,b,c,d){var e=a.spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),target:r.toJson({geometryType:t.getJsonType(a),geometry:a.toJson()}),reshaper:r.toJson(b.toJson())});var h=this._reshapeHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,e,c,d,l)},error:function(a){g(a,d,l)}});return l},_reshapeHandler:function(a,b,c,d,f,e){try{var h=t.fromJson(a.geometry).setSpatialReference(c);
this._successHandler([h],"onReshapeComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onReshapeComplete:function(){},cut:function(a,b,c,d){var e=a[0].spatialReference,h=g.map(a,function(a){return a.toJson()});a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),target:r.toJson({geometryType:t.getJsonType(a[0]),geometries:h}),cutter:r.toJson(b.toJson())});var l=this._cutHandler,q=this._errorHandler,y=new p(f._dfdCanceller);y._pendingDfd=k({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(a,b){l(a,b,e,c,d,y)},error:function(a){q(a,d,y)}});return y},_cutHandler:function(a,b,c,d,f,e){try{var h=a.geometries,k={};k.cutIndexes=a.cutIndexes;k.geometries=[];g.forEach(h,function(a){k.geometries.push(t.fromJson(a).setSpatialReference(c))});this._successHandler([k],"onCutComplete",d,e)}catch(l){this._errorHandler(l,f,e)}},onCutComplete:function(){},intersect:function(a,b,c,d){var e=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a)),
geometry:r.toJson({geometryType:t.getJsonType(b),geometry:b.toJson()})});var h=this._intersectHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,e,c,d,l)},error:function(a){g(a,d,l)}});return l},_intersectHandler:function(a,b,c,d,f,e){try{var h=[];g.forEach(a.geometries,function(a){h.push(t.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onIntersectComplete",d,e)}catch(k){this._errorHandler(k,
f,e)}},onIntersectComplete:function(){},difference:function(a,b,c,d){var e=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a)),geometry:r.toJson({geometryType:t.getJsonType(b),geometry:b.toJson()})});var h=this._differenceHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,e,c,d,l)},error:function(a){g(a,
d,l)}});return l},_differenceHandler:function(a,b,c,d,f,e){try{var h=[];g.forEach(a.geometries,function(a){h.push(t.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onDifferenceComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onDifferenceComplete:function(){},buffer:function(a,b,c){var d=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.outSpatialReference||a.geometries[0].spatialReference,h=this._bufferHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+
"/buffer",content:d,callbackParamName:"callback",load:function(a,d){h(a,d,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_bufferHandler:function(a,b,c,f,e,h){try{var k=a.geometries;a=[];var g,l=k.length;for(g=0;g<l;g++)a[g]=new d({spatialReference:c,rings:k[g].rings});this._successHandler([a],"onBufferComplete",f,h)}catch(m){this._errorHandler(m,e,h)}},onBufferComplete:function(){},areasAndLengths:function(a,b,c){a=m.mixin({},this._url.query,{f:"json"},a.toJson());var d=this._areasAndLengthsHandler,
e=this._errorHandler,h=new p(f._dfdCanceller);h._pendingDfd=k({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,f){d(a,f,b,c,h)},error:function(a){e(a,c,h)}});return h},_areasAndLengthsHandler:function(a,b,c,d,f){try{this._successHandler([a],"onAreasAndLengthsComplete",c,f)}catch(e){this._errorHandler(e,d,f)}},onAreasAndLengthsComplete:function(){},lengths:function(a,b,c){a=m.mixin({},this._url.query,{f:"json"},a.toJson());var d=this._lengthsHandler,e=this._errorHandler,
h=new p(f._dfdCanceller);h._pendingDfd=k({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(a,f){d(a,f,b,c,h)},error:function(a){e(a,c,h)}});return h},_lengthsHandler:function(a,b,c,d,f){try{this._successHandler([a],"onLengthsComplete",c,f)}catch(e){this._errorHandler(e,d,f)}},onLengthsComplete:function(){},labelPoints:function(a,b,c){var d=g.map(a,function(a){return a.toJson()}),e=a[0].spatialReference,d=m.mixin({},this._url.query,{f:"json",sr:e.wkid?e.wkid:r.toJson(e.toJson()),
polygons:r.toJson(d)}),h=this._labelPointsHandler,l=this._errorHandler,q=new p(f._dfdCanceller);q._pendingDfd=k({url:this._url.path+"/labelPoints",content:d,callbackParamName:"callback",load:function(d,f){h(d,f,a,e,b,c,q)},error:function(a){l(a,c,q)}});return q},_labelPointsHandler:function(a,b,c,d,f,e,h){try{var k=[];g.forEach(a.labelPoints,function(a){k.push(t.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onLabelPointsComplete",f,h)}catch(l){this._errorHandler(l,e,h)}},onLabelPointsComplete:function(){},
relation:function(a,b,c){a=m.mixin({},this._url.query,{f:"json"},a.toJson());var d=this._relationHandler,e=this._errorHandler,h=new p(f._dfdCanceller);h._pendingDfd=k({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,f){d(a,f,b,c,h)},error:function(a){e(a,c,h)}});return h},_relationHandler:function(a,b,c,d,f){try{this._successHandler([a.relations],"onRelationComplete",c,f)}catch(e){this._errorHandler(e,d,f)}},onRelationComplete:function(){},trimExtend:function(a,
b,c){var d=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.sr,h=this._trimExtendHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/trimExtend",content:d,callbackParamName:"callback",load:function(a,d){h(a,d,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_trimExtendHandler:function(a,b,d,f,e,h){try{var k=a.geometries;a=[];var g,l=k.length;for(g=0;g<l;g++)a[g]=new c({spatialReference:d,paths:k[g].paths});this._successHandler([a],"onTrimExtendComplete",
f,h)}catch(m){this._errorHandler(m,e,h)}},onTrimExtendComplete:function(){},densify:function(a,b,c){var d=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometries[0].spatialReference,h=this._densifyHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/densify",content:d,callbackParamName:"callback",load:function(a,d){h(a,d,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_densifyHandler:function(a,b,c,d,f,e){try{var h=[];g.forEach(a.geometries,function(a){h.push(t.fromJson(a).setSpatialReference(c))});
this._successHandler([h],"onDensifyComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onDensifyComplete:function(){},generalize:function(a,b,c){var d=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometries[0].spatialReference,h=this._generalizeHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/generalize",content:d,callbackParamName:"callback",load:function(a,d){h(a,d,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_generalizeHandler:function(a,
b,c,d,f,e){try{var h=[];g.forEach(a.geometries,function(a){h.push(t.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onGeneralizeComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onGeneralizeComplete:function(){},offset:function(a,b,c){var d=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometries[0].spatialReference,h=this._offsetHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=k({url:this._url.path+"/offset",content:d,callbackParamName:"callback",load:function(a,
d){h(a,d,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_offsetHandler:function(a,b,c,d,f,e){try{var h=[];g.forEach(a.geometries,function(a){h.push(t.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onOffsetComplete",d,e)}catch(k){this._errorHandler(k,f,e)}},onOffsetComplete:function(){},distance:function(a,b,c){var d=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometry1.spatialReference,h=this._distanceHandler,g=this._errorHandler,l=new p(f._dfdCanceller);l._pendingDfd=
k({url:this._url.path+"/distance",content:d,callbackParamName:"callback",load:function(a,d){h(a,d,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_distanceHandler:function(a,b,c,d,f,e){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",d,e)}catch(h){this._errorHandler(h,f,e)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,b,c){var d={};m.isObject(a.sr)?d.sr=a.sr.wkid||r.toJson(a.sr.toJson()):d.sr=a.sr;d.coordinates=r.toJson(a.coordinates);d.conversionType=a.conversionType||
"MGRS";d.conversionMode=a.conversionMode;d.numOfDigits=a.numOfDigits;d.rounding=a.rounding;d.addSpaces=a.addSpaces;a=m.mixin({},this._url.query,{f:"json"},d);var e=this._toGeoCoordinateHandler,h=this._errorHandler,g=new p(f._dfdCanceller);g._pendingDfd=k({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,d){e(a,d,b,c,g)},error:function(a){h(a,c,g)}});return g},_toGeoCoordinateHandler:function(a,b,c,d,f){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
c,f)}catch(e){this._errorHandler(e,d,f)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,b,c){var d={};m.isObject(a.sr)?d.sr=a.sr.wkid||r.toJson(a.sr.toJson()):d.sr=a.sr;d.strings=r.toJson(a.strings);d.conversionType=a.conversionType||"MGRS";d.conversionMode=a.conversionMode;a=m.mixin({},this._url.query,{f:"json"},d);var e=this._fromGeoCoordinateHandler,h=this._errorHandler,g=new p(f._dfdCanceller);g._pendingDfd=k({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(a,d){e(a,d,b,c,g)},error:function(a){h(a,c,g)}});return g},_fromGeoCoordinateHandler:function(a,b,c,d,f){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",c,f)}catch(e){this._errorHandler(e,d,f)}},onFromGeoCoordinateStringComplete:function(){}});m.mixin(q,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});e("extend-esri")&&m.setObject("tasks.GeometryService",q,s);return q})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(q,m,g,r,p,e,s,k,f,l,b,c,d,h,t,a,n,w,D,u,F,v,x,y,H,I,G,Ba,N,X,S,P,C,A,z,Q,E,B,J,T,O,R,U,L,aa,ba,da,Ca,Y,ca){var ea=D.defaults,K=g(E,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],
"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=ca;b=b||{};this.showLabels=null!=b.showLabels?b.showLabels:!0;
this._outFields=b.outFields;this._defnExpr=b.definitionExpression;this._loadCallback=b.loadCallback;var c=b._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=b.quantize?b.quantize:!0;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=b.editSummaryCallback;this.userId=b.userId;this.userIsAdmin=
b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=
null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=K,c=this.mode=n.isDefined(b.mode)?b.mode:d.MODE_ONDEMAND;this._isStream&&(this.mode=c=d.MODE_STREAM);switch(c){case d.MODE_SNAPSHOT:this.currentMode=
d.MODE_SNAPSHOT;this._mode=new L(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=d.MODE_ONDEMAND;this._tileWidth=b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new aa(this);this.latticeTiling=b.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION;this._mode=new ba(this);this._isSelOnly=!0;break;case d.MODE_STREAM:this.currentMode=d.MODE_STREAM,this._mode=new da(this),this._isStream=!0}this._initLayer=p.hitch(this,this._initLayer);
this._selectHandler=p.hitch(this,this._selectHandler);this._editable=!1;if(p.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=this._isStream?d.MODE_STREAM:d.MODE_SNAPSHOT,this._initLayer(a),this;this._task=new N(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(d=b.resourceInfo)?this._initLayer(d):(this.source&&
(d={source:this.source.toJson()},this._url.query=p.mixin(this._url.query,{layer:s.toJson(d)})),this.gdbVersion&&(this._url.query=p.mixin(this._url.query,{gdbVersion:this.gdbVersion})),w({url:c,content:p.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();
this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);this._collection&&(this._isStream||(this.currentMode=K.MODE_SNAPSHOT,this._mode=new L(this)),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===
this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var c=this.capabilities=a.capabilities;c&&-1!==c.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);n.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=s.toJson(this._json);if(this.isEditable())this._setMaxOffset(null);
else if(this.mode!==K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))this._autoGeneralize=n.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===K.MODE_ONDEMAND||this.mode===K.MODE_AUTO,delete this._optAutoGen;var c=a.effectiveMinScale||a.minScale,d=a.effectiveMaxScale||a.maxScale;!this._hasMin&&c&&this.setMinScale(c);!this._hasMax&&d&&this.setMaxScale(d);this.layerId=a.id;this.name=a.name;this.description=a.description;
this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new C(a.extent);this.initialExtent=new C(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new F(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=a.hasM||!1;
this.hasZ=a.hasZ||!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=a.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=
a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;
this.allowGeometryUpdates=n.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!a.allowUpdateWithoutMValues;this.advancedQueryCapabilities=a.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.useStandardizedQueries=a.useStandardizedQueries;this.tileMaxRecordCount=a.tileMaxRecordCount;this.standardMaxRecordCount=a.standardMaxRecordCount;this._setMaxOffset(this._maxOffset,
!0);this._isTable="Table"===this.type;for(var f=this.fields=[],d=a.fields,c=0;c<d.length;c++)f.push(new B(d[c]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){d=a.fields;for(c=0;c<d.length;c++)if(f=d[c],"esriFieldTypeOID"===f.type){this.objectIdField=f.name;break}}!this.objectIdField&&!this._isStream&&console.debug("esri.layers.FeatureLayer: "+n.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!n.isDefined(this._nextId)){d=this.objectIdField;
f=-1;if(this._collection&&d)for(var h=(c=this._featureSet)&&c.features,k=h?h.length:0,g,c=0;c<k;c++)g=(g=h[c].attributes)&&g[d],g>f&&(f=g);this._nextId=f+1}this.globalIdField=a.globalIdField;if(c=this.typeIdField=a.typeIdField)if(c=!this._getField(c)&&this._getField(c,!0))this.typeIdField=c.name;this.visibilityField=a.visibilityField;if(d=a.defaultSymbol)this.defaultSymbol=H.fromJson(d);var m=this.types=[],q=a.types,t,r,f=(c=this.editFieldsInfo)&&c.creatorField,h=c&&c.editorField;g=f||h;k=[];if(q)for(c=
0;c<q.length;c++)t=new T(q[c]),r=t.templates,g&&(r&&r.length)&&(k=k.concat(r)),m.push(t);q=a.templates;t=this.templates=[];if(q)for(c=0;c<q.length;c++)m=new O(q[c]),g&&k.push(m),t.push(m);for(c=0;c<k.length;c++)if(g=p.getObject("prototype.attributes",!1,k[c]))f&&delete g[f],h&&delete g[h];if(c=a.timeInfo)this.timeInfo=new J(c),this._startTimeField=c.startTimeField,this._endTimeField=c.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?c.trackIdField=
this._trackIdField:this._trackIdField=c.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var c=a.drawingInfo,w;if((f=c&&c.labelingInfo)&&!this.labelingInfo)this.labelingInfo=e.map(f,function(a){return new U(a)}),this._fixLabelExpr();if(!this.renderer)if(c&&c.renderer){if(w=c.renderer,this.setRenderer(Ba.fromJson(w)),"classBreaks"===w.type&&this.renderer.setMaxInclusive(!0),!this._collection){var u=w.type,d=[];w=this.renderer;switch(u){case "simple":d.push(w.symbol);
break;case "uniqueValue":case "classBreaks":d.push(w.defaultSymbol),d=d.concat(e.map(w.infos,function(a){return a.symbol}))}var d=e.filter(d,n.isDefined),D=this._url.path+"/images/",z=this._getToken();e.forEach(d,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=D+b),z&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+z))})}}else if(d)q=this.types,0<q.length?(w=new G(this.defaultSymbol,this.typeIdField),e.forEach(q,function(a){w.addValue(a.id,a.symbol)})):w=
new I(this.defaultSymbol),this.setRenderer(w);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":u=new v;break;case "esriGeometryPolyline":u=new x;break;case "esriGeometryPolygon":u=new y;break;default:this.hasXYFootprint()&&(u=new y)}this.setRenderer(u?new I(u):null)}u=c&&c.transparency||0;!this.hasOwnProperty("opacity")&&0<u&&(this.opacity=1-u/100);if((l("ie")||7<=l("trident")||l("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;
this.statistics=a.statistics;this._fixRendererFields();this._checkFields();this._updateCaps();var A=function(){this.currentMode!==K.MODE_SNAPSHOT&&(this.queryPagination=!1);null!=this._maxOffset&&!this._isFractionalOffsetAllowed()&&this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(u=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new S(u)),this._fcAdded=!0,A.call(this)):this._forceIdentity(this._limitPromise?
function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;A.call(a)})}:A)}},setShowLabels:function(a){this.showLabels=a;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(a){this.inherited(arguments);var b=this._map;this._ager=!(!a||!a.observationAger||!a.observationRenderer);a&&"colors"in a&&"blurRadius"in a&&"maxPixelIntensity"in a?"esriGeometryPoint"==this.geometryType&&(!this._heatmapManager&&
b)&&(this._heatmapManager=new Y(this),this._heatmapManager.initialize(b)):this.renderer&&this.renderer.getRendererInfo?e.some(this.renderer.rendererInfos,function(a){return a.renderer&&"colors"in a.renderer&&"blurRadius"in a.renderer})||(this._heatmapManager=null):this._heatmapManager=null;if(a){var c=[],b=e.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],n.isDefined),d=function(a){return null!=a&&"function"!=typeof a&&a};e.forEach(b,function(a){var b=d(a.attributeField),
f=d(a.attributeField2);a=d(a.attributeField3);!1!==b&&c.push(b);!1!==f&&c.push(f);!1!==a&&c.push(a)});this._rendererFields=c}else this._rendererFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||
!a.observationAger||!a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},_setMap:function(a){var b=this.inherited(arguments),c=this._mode,d=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=d._selectedFeatures[a&&a[d.objectIdField]])&&a.attr("data-selected",
"")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);r.disconnect(this._zoomConnect);r.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var a=this._mode;a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return e.filter(this._getOutFields(),
function(a){return"*"===a||!!this._getField(a)},this)},getField:function(a){return this._getField(a,!0)},getFieldLabel:function(a){var b=this.infoTemplate,b=b&&b.getFieldInfo&&b.getFieldInfo(a);a=p.isFunction(a)?null:this.getField(a);var c=b||a,d="";c&&(d=b&&b.label||a&&a.alias||c.name||c.fieldName);return d},getDomain:function(a,b){var c,d,f=b&&b.feature,h=f&&this.typeIdField&&f.attributes&&f.attributes[this.typeIdField];null!=h&&e.some(this.types,function(b){if(b.id==h){if((c=b.domains&&b.domains[a])&&
"inherited"===c.type)c=this._getLayerDomain(a),d=!0;return!0}return!1},this);!d&&!c&&(c=this._getLayerDomain(a));return c},_getLayerDomain:function(a){var b;e.some(this.fields,function(c){c.name===a&&(b=c.domain);return!!b});return b},getType:function(a){var b,c=a&&this.typeIdField&&a.attributes&&a.attributes[this.typeIdField];e.some(this.types,function(a){a.id==c&&(b=a);return!!b});return b},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),
this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;var c=a&&a.feature;a=a&&a.userId||this.getUserId();var d=e.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],p.trim),f=(b=-1<e.indexOf(d,"editing"))&&-1<e.indexOf(d,"create"),h=b&&-1<e.indexOf(d,"update"),
d=b&&-1<e.indexOf(d,"delete"),k=this.ownershipBasedAccessControlForFeatures,g=this.editFieldsInfo,n=g&&g.creatorField,g=g&&g.realm,c=(c=c&&c.attributes)&&n?c[n]:void 0,l=!!this.userIsAdmin,n=!k||l||!(!k.allowOthersToUpdate&&!k.allowUpdateToOthers),m=!k||l||!(!k.allowOthersToDelete&&!k.allowDeleteToOthers),q=!k||l||!k.hasOwnProperty("allowAnonymousToUpdate")||k.allowAnonymousToUpdate,k=!k||l||!k.hasOwnProperty("allowAnonymousToDelete")||k.allowAnonymousToDelete;a&&g&&(a=a+"@"+g);if(l||b&&!f&&!h&&!d)f=
h=d=!0;b={canCreate:f,canUpdate:h,canDelete:d};a||(b.canUpdate=b.canUpdate&&q,b.canDelete=b.canDelete&&k);null===c?(b.canUpdate=b.canUpdate&&n,b.canDelete=b.canDelete&&m):""!==c&&(c&&a.toLowerCase()!==c.toLowerCase())&&(b.canUpdate=b.canUpdate&&n,b.canDelete=b.canDelete&&m);return b},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=
a},getEditSummary:function(a,b,c){c=n.isDefined(c)?c:(new Date).getTime();var d="";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(p.isString(c))d=c;else{if(c){a=c.action;b=c.userId;var f=c.timeValue,e=0;a&&e++;b&&e++;n.isDefined(f)&&e++;1<e&&(d=("edit"===a?"edit":"create")+(b?"User":"")+(n.isDefined(f)?c.displayPattern:""))}d=d&&n.substitute(c,this.i18n.layers.FeatureLayer[d])}return d},getEditInfo:function(a,b,c){if(this.loaded){c=n.isDefined(c)?c:(new Date).getTime();
b=b&&b.action||"last";var d=this.editFieldsInfo,f=d&&d.creatorField,e=d&&d.creationDateField,h=d&&d.editorField,d=d&&d.editDateField,h=(a=a&&a.attributes)&&h?a[h]:void 0,d=a&&d?a[d]:null,f=this._getEditData(a&&f?a[f]:void 0,a&&e?a[e]:null,c);c=this._getEditData(h,d,c);var k;switch(b){case "creation":k=f;break;case "edit":k=c;break;case "last":k=c||f}k&&(k.action=k===c?"edit":"creation");return k}},_getEditData:function(a,b,c){var d,e,h;n.isDefined(b)&&(e=c-b,h=0>e?"Full":6E4>e?"Seconds":12E4>e?"Minute":
36E5>e?"Minutes":72E5>e?"Hour":864E5>e?"Hours":6048E5>e?"WeekDay":"Full");if(void 0!==a||h)d=d||{},d.userId=a,h&&(a=f.format,c=new Date(b),d.minutes=Math.floor(e/6E4),d.hours=Math.floor(e/36E5),d.weekDay=a(c,{datePattern:"EEEE",selector:"date"}),d.formattedDate=a(c,{selector:"date"}),d.formattedTime=a(c,{selector:"time"}),d.displayPattern=h,d.timeValue=b);return d},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(a){this.isEditable()||this._setMaxOffset(a,
!0);return this},getMaxAllowableOffset:function(){var a=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:a},_setMaxOffset:function(a,b){if(null==a)return delete this._maxOffset,delete this._quantizationParameters,this;if(this.quantize&&this.supportsCoordinatesQuantization)"esriGeometryPolyline"===this.geometryType?this._maxOffset=a:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:a,
extent:this.fullExtent};else{if(!this._isFractionalOffsetAllowed()||!b)a=Math.floor(a);isNaN(a)||0===a?delete this._maxOffset:this._maxOffset=a;delete this._quantizationParameters}return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(a){a=(a=a&&a.split("-"))&&a[0]&&a[0].toLowerCase();return-1!==e.indexOf(this._langsWithDot,a)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),
setAutoGeneralize:function(a){if(this.loaded){if(!this.isEditable()&&this.mode!==K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))(this._autoGeneralize=a)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)}else this._optAutoGen=a;return this},setGDBVersion:function(a){if(!this._collection&&a!==this.gdbVersion&&(a||this.gdbVersion))this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=
p.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange();return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+
this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,c,d){b=b||K.SELECTION_NEW;this._hasPartialSelectedFeatures=!1;a=this._getShallowClone(a);var f=this._map,e,g=this,n=u._fixDfd(new k(u._dfdCanceller));
a.outFields=this.getOutFields();a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;f&&(a.outSpatialReference=new F(f.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return e={features:[]},this._selectHandler(e,b,c,d,n),n;if(f=this._canDoClientSideQuery(a))n._pendingDfd=h(this._doQuery(a,f)),n._pendingDfd.then(function(a){e={features:a};g._selectHandler(e,b,c,d,n)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,
d,n,!0),n;var l=this;this._ts&&(a._ts=(new Date).getTime());(n._pendingDfd=this._task.execute(a)).addCallbacks(function(a){l._selectHandler(a,b,c,d,n)},function(a){l._hasPartialSelectedFeatures=!0;l._resolve([a],null,d,n,!0)})}return n},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=this._selectedFeatures,c=this._mode,d;for(d in b)b.hasOwnProperty(d)&&(this._unSelectFeatureIIf(d,c),c._removeFeatureIIf(d));
this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=
/\[([^\[\]]+)\]/ig,b,c=this,d=function(a,b){var d=c._getField(b,!0);return"["+(d&&d.name||b)+"]"};e.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=b.replace(a,d)})},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,b,c,d,f,h){var k=h.assembly,n=h.dfd;this._applyNormalized(a,k&&k[0]);this._applyNormalized(b,k&&k[1]);this.onBeforeApplyEdits(a,b,c);var g={},l=this.objectIdField,k={f:"json"},m=!1;if(this._collection)h={},h.addResults=a?e.map(a,
function(){m=!0;return{objectId:this._nextId++,success:!0}},this):null,h.updateResults=b?e.map(b,function(a){m=!0;var b=a.attributes[l];g[b]=a;return{objectId:b,success:!0}},this):null,h.deleteResults=c?e.map(c,function(a){m=!0;return{objectId:a.attributes[l],success:!0}},this):null,m?this._editHandler(h,a,g,d,f,n):this._resolve([h.addResults,h.updateResults,h.deleteResults],null,d,n);else{a&&0<a.length&&(k.adds=this._convertFeaturesToJson(a,0,1),m=!0);if(b&&0<b.length){for(h=0;h<b.length;h++){var q=
b[h];g[q.attributes[l]]=q}k.updates=this._convertFeaturesToJson(b,0,0,1);m=!0}if(c&&0<c.length){b=[];for(h=0;h<c.length;h++)b.push(c[h].attributes[l]);k.deletes=b.join(",");m=!0}if(m){var t=this;return w({url:this._url.path+"/applyEdits",content:p.mixin(k,this._url.query),callbackParamName:"callback",load:function(b){t._editHandler(b,a,g,d,f,n)},error:function(a){t._resolve([a],null,f,n,!0)}},{usePost:!0})}this._resolve([],null,d,n)}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",
a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,b,c){return this._query("executeForCount","onQueryCountComplete",a,b,c)},queryExtent:function(a,b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(a,c,d){var f=this._url.path+"/"+a+"/attachments",h=new k(u._dfdCanceller),
n=this;h._pendingDfd=w({url:f,content:p.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(d){d=d.attachmentInfos;var k;e.forEach(d,function(c){k=b.objectToQuery({gdbVersion:n._url.query&&n._url.query.gdbVersion,layer:n._url.query&&n._url.query.layer,token:n._getToken()});c.url=f+"/"+c.id+(k?"?"+k:"");c.objectId=a});n._resolve([d],"onQueryAttachmentInfosComplete",c,h)},error:function(a){n._resolve([a],null,d,h,!0)}});return h},addAttachment:function(a,b,c,d){return this._sendAttachment("add",
a,b,c,d)},updateAttachment:function(a,b,d,f,e){d.appendChild(c.create("input",{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,d,f,e)},deleteAttachments:function(a,b,c,d){var f=this._url.path+"/"+a+"/deleteAttachments",h=new k(u._dfdCanceller),n=this;b={f:"json",attachmentIds:b.join(",")};h._pendingDfd=w({url:f,content:p.mixin(b,this._url.query),callbackParamName:"callback",load:p.hitch(this,function(b){b=b.deleteAttachmentResults;b=e.map(b,function(b){b=new R(b);
b.attachmentId=b.objectId;b.objectId=a;return b});n._resolve([b],"onDeleteAttachmentsComplete",c,h)}),error:function(a){n._resolve([a],null,d,h,!0)}},{usePost:!0});return h},addType:function(a){var b=this.types;if(b){if(e.some(b,function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;e.some(b,function(b,d){return b.id==a?(c=d,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,
1)[0]}}},toJson:function(){var a=this._json;if(a=p.isString(a)?s.fromJson(a):p.clone(a)){var a=a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=e.map(this.types||[],function(a){return a.toJson()});var d=this.renderer,f=this.labelingInfo,h=b.drawingInfo;if((d||f)&&!h)h=b.drawingInfo={};h&&(d&&-1===d.declaredClass.indexOf("TemporalRenderer"))&&(h.renderer=d.toJson());f&&(h.labelingInfo=e.map(f,function(a){return a.toJson()}))}d=null;if(!c||
this._fcAdded)d={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};a.featureSet=p.mixin({},a.featureSet||{},d);a.featureSet.transform&&(f=a.featureSet.transform,delete a.featureSet.transform,d=new S(a.featureSet),d.quantize(f),a.featureSet=d.toJson());c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},
onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},_forceIdentity:function(b){var c=this,d,f=this._url&&this._url.path;
d=f&&f.toLowerCase().indexOf("/rest/services");var e=this.editFieldsInfo,e=e&&(e.creatorField||e.editorField);(this.userIsAdmin||e)&&!this._getToken()&&-1<d&&a.id?(d=f.substring(0,d)+"/rest/info",w({url:d,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(b){if(b.owningSystemUrl)return a.id.checkSignInStatus(b.owningSystemUrl+"/sharing")}).then(function(b){if(b)return a.id.getCredential(f)}).then(function(a){a&&c._findCredential()}).always(function(){b.call(c)})):b.call(this)},
_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;if(this.mode===K.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&c>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto))this.currentMode=K.MODE_SNAPSHOT,this._mode=new L(this),this._isSnapshot=this._autoSnapshot=
!0},_queryLimit:function(){var a=this,b=new k;this._limitPromise=b.promise;setTimeout(function(){var c=new X,d=new P;d.statisticType="exceedslimit";d.maxPointCount=a.maxPointCountForAuto;d.maxRecordCount=a.maxRecordCountForAuto;d.maxVertexCount=a.maxVertexCountForAuto;d.outStatisticFieldName="exceedslimit";c.outStatistics=[d];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=p.trim(this.capabilities||""),c=e.map(b?
b.split(","):[],p.trim),d=e.map(b?b.toLowerCase().split(","):[],p.trim),b=e.indexOf(d,"editing"),f,d={Create:e.indexOf(d,"create"),Update:e.indexOf(d,"update"),Delete:e.indexOf(d,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(f in d)-1<d[f]&&a.push(d[f]);a.sort();for(f=a.length-1;0<=f;f--)c.splice(a[f],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);
var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);var b=this._mode,c=this._map,d=this._getRenderer();if(a.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&!this._trackManager&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer)))this._trackManager=new Ca(this),this._trackManager.initialize(c),this._childLayer=this._trackManager.container;d&&("colors"in d&&"blurRadius"in d&&"maxPixelIntensity"in
d)&&("esriGeometryPoint"==this.geometryType&&!this._heatmapManager)&&(this._heatmapManager=new Y(this),this._heatmapManager.initialize(c));if(this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset())d=this.generalizeForScale,this._calculatedScale=d=this.maxScale?this.maxScale:this.minScale?Math.min(d,this.minScale):Math.min(d,Q.getScale(c,this.initialExtent)),
this._calcMaxOffset=c.extent.getWidth()/c.width/c.getScale()*d;this._zoomConnect=r.connect(c,"onZoomEnd",this,this._zoomEndHandler);this._updateMaxOffset();this._needsRefresh=!1;b&&b.startup()}else this._zoomEndHandler(),b&&b.resume()},_zoomEndHandler:function(){var a=this._map;this._updateMaxOffset();this._prevScale=a.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._autoSnapshot?(a=this.getMaxAllowableOffset(),
this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=a!=this.getMaxAllowableOffset())):this._setMaxOffset(a.extent.getWidth()/a.width,!a.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var a=this._map.getScale(),b=this._calculatedScale,c=this._calcMaxOffset,d=this._prevScale;return a>=b&&(null==d||d<b)?c:a<b&&(null==d||d>=b)?null:this.getMaxAllowableOffset()}},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&
this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,this._timeConnect||(this._timeConnect=r.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,r.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):
a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);a.maxAllowableOffset||(a.maxAllowableOffset=this._maxOffset);a.quantizationParameters=this._quantizationParameters;b&&this.supportsAdvancedQueries&&
(a.orderByFields=a.orderByFields||this.getOrderByFields());if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,d=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(d&&c&&c.hasOwnProperty(d))a[c[d]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],c=this._map,d;if(!(this._isTable||
!c&&!this._collection))if(!a.text&&!(a.where&&a.where!==this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length&&(d=this.getOrderByFields()||[])&&a.orderByFields.join()!==d.join()||a.outStatistics||a.returnDistinctValues)){d=this._isSnapshot;var f=this._isSelOnly,h=a.geometry;if(h)if(!f&&a.spatialRelationship===X.SPATIAL_REL_INTERSECTS&&"extent"===h.type&&(d||c.extent.contains(h)))b.push(1);else return;if(c=a.objectIds)if(d)b.push(2);else{var h=c.length,k=this._mode,n=0,g;for(g=0;g<
h;g++)k._getFeature(c[g])&&n++;if(n===h)b.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,c=this._mapTimeExtent,d)a&&b.push(3);else if(f){if(a)return}else if(c)if(-1!==e.indexOf(b,2))a&&b.push(3);else if(-1!==e.indexOf(b,1))a==c&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return q.toAbsMid?q.toAbsMid(a):m.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,c){var d=[],f=this.objectIdField,h=this,n=new k,g=new k,
l=this.graphics;if(-1!==e.indexOf(b,1)){var m=this.spatialIndex||this._map&&this._map.spatialIndex,q,t=a.geometry._normalize(null,!0);null==m&&ea.autoSpatialIndexing?q=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(p.hitch(this,p.partial(this._getFromIndex,t,m)),function(a){g.resolve(p.hitch(this,p.partial(this._filterByExtent,l,t)))}):m&&(q=this._getFromIndex(t,m));q?q.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(d=d.concat(a[b].results));g.resolve(d)}).otherwise(function(a){g.reject(a)}):
g.resolve(this._filterByExtent(l,t))}else g.resolve(l);g.then(function(k){d=k;if(-1!==e.indexOf(b,2)){var g=a.objectIds;d=e.filter(d,function(a){return-1<e.indexOf(g,a.attributes[f])})}-1!==e.indexOf(b,3)&&h.timeInfo&&(k=a.timeExtent,d=h._filterByTime(d,k.startTime,k.endTime).match);c&&(d=e.map(d,function(a){return a.attributes[f]},this));n.resolve(d)});return n},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;return t(e.map(a,function(a){return b.intersects(a,
c)}))},_filterByExtent:function(a,b){for(var c=[],d=0,f=a.length;d<f;d++){var e=a[d],h=e.geometry;h&&(this.normalization&&b.length?(b[0].intersects(h)||b[1].intersects(h))&&c.push(e):b.intersects(h)&&c.push(e))}return c},_filterByTime:function(a,b,c){var d=this._startTimeField,f=this._endTimeField,e;this._twoTimeFields||(e=d||f);var h=n.isDefined,k=[],g=[],l,m=a.length,q,p;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(e)for(l=0;l<m;l++)q=a[l],p=q.attributes,d=p[e],d>=b&&d<=c?k.push(q):g.push(q);
else for(l=0;l<m;l++)q=a[l],p=q.attributes,e=p[d],p=p[f],e=h(e)?e:-Infinity,p=h(p)?p:Infinity,e>=b&&e<=c||p>=b&&p<=c||b>=e&&c<=p?k.push(q):g.push(q);return{match:k,noMatch:g}},_getSizeVariables:function(a){return a&&e.filter(a.getVisualVariablesForType("sizeInfo",!1),function(a){return!(!a.field&&!a.valueExpression)})},_needClientSideSorting:function(a){return this._collection?!(!a||!a.length):e.some(a,function(a){return!!a.valueExpression})},_sortFeatures:function(a){var b=this.renderer,c=this._getSizeVariables(b);
if(a&&1<a.length&&this._needClientSideSorting(c)){var d=c[0],f=this;a.sort(function(a,c){var e=b._getDataValue(a,d,"sizeInfo",null,f),h=b._getDataValue(c,d,"sizeInfo",null,f);return null==e?-1:null==h?1:h-e})}return a},_resolve:function(a,b,c,d,f){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&u._resDfd(d,a,f)},_getShallowClone:function(a){var b=new X,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_query:function(a,b,c,d,f){var n=this,g=this._map,l=new k(u._dfdCanceller),m=c,q,p;if("executeRelationshipQuery"!==
a){var m=this._getShallowClone(c),t=this.getOutFields();m.outFields||(m.outFields=t);m.outFields&&m.outFields.length&&(p=-1<e.indexOf(t,"*")?!1:!e.every(m.outFields,function(a){return-1<e.indexOf(t,a)}));m.returnGeometry=c.hasOwnProperty("returnGeometry")?c.returnGeometry:!c.outStatistics;m.returnGeometry&&(m.multipatchOption=this.multipatchOption);var r;g&&(c=g&&g.spatialReference,(g=m.outSpatialReference)?q=!g.equals(c):m.outSpatialReference=new F(c.toJson()));if(!this._applyQueryFilters(m,"execute"===
a&&!m.outStatistics)){switch(a){case "execute":r=new S({features:[]});break;case "executeForIds":r=[];break;case "executeForCount":r=0;break;case "executeForExtent":r={}}this._resolve([r],b,d,l);return l}if(c="executeForExtent"!==a&&!q&&!p&&this._canDoClientSideQuery(m))return l._pendingDfd=h(this._doQuery(m,c,"executeForIds"===a||"executeForCount"===a)),l._pendingDfd.then(function(c){switch(a){case "execute":r=new S;r.features=c;break;case "executeForIds":r=c;break;case "executeForCount":r=c.length}n._resolve([r],
b,d,l)}),l}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,f,l,!0),l;this._ts&&(m._ts=(new Date).getTime());(l._pendingDfd=this._task[a](m)).addCallbacks(function(c){var f=!!m.outStatistics||q||p;if("execute"===a||"executeRelationshipQuery"===a){var e,h;if("execute"===a){e=c.features;h=e.length;for(h-=1;0<=h;h--)if(e[h]._layer=n,!f&&!n._isTable){var k=n._mode._getFeature(e[h].attributes[n.objectIdField]);k&&e.splice(h,1,k)}}else for(k in c)if(c.hasOwnProperty(k)){e=
c[k].features;h=e.length;for(h-=1;0<=h;h--)e[h]._layer=n}}n._resolve([c],b,d,l)},function(a){n._resolve([a],null,f,l,!0)});return l},_convertFeaturesToJson:function(a,b,c,d){var f=[],h=this._selectionSymbol,k=this.visibilityField,n,g=this.objectIdField;if(this.loaded&&(c||d))n=e.filter(this.fields,function(a){return!1===a.editable&&(!d||a.name!==g)});for(c=0;c<a.length;c++){var l=a[c],m={},q=l.geometry,t=l.attributes,r=l.symbol;if(q&&(!d||!this.loaded||this.allowGeometryUpdates))m.geometry=q.toJson();
k?(m.attributes=t=p.mixin({},t),t[k]=l.visible?1:0):t&&(m.attributes=p.mixin({},t));m.attributes&&(n&&n.length)&&e.forEach(n,function(a){delete m.attributes[a.name]});r&&r!==h&&(m.symbol=r.toJson());f.push(m)}return b?f:s.toJson(f)},_selectHandler:function(a,b,c,d,f){var e;d=K;switch(b){case d.SELECTION_NEW:this.clearSelection(!0);e=!0;break;case d.SELECTION_ADD:e=!0;break;case d.SELECTION_SUBTRACT:e=!1}d=a.features;var h=this._mode,k=[],n=this.objectIdField,g,l;if(e)for(e=0;e<d.length;e++)g=d[e],
l=g.attributes[n],g=h._addFeatureIIf(l,g),k.push(g),this._selectFeatureIIf(l,g,h);else for(e=0;e<d.length;e++)g=d[e],l=g.attributes[n],this._unSelectFeatureIIf(l,h),l=h._removeFeatureIIf(l),k.push(l||g);this._isSelOnly&&h._applyTimeFilter(!0);this._hasPartialSelectedFeatures=!!a.exceededTransferLimit;this._resolve([k,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,f);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var d=this._selectedFeatures,
f=d[a];f||(c._incRefCount(a),d[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return f||b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&
!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),a=e.filter(a,function(a,b,c){return!!a&&e.indexOf(c,a)===b}),b=p.clone(this._outFields);if(b){if(-1!==e.indexOf(b,"*"))return b;e.forEach(a,function(a){-1===e.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();
e.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+n.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!a&&(!this._isTable&&!this._fserver&&!this._collection&&!this._isStream)&&(e.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+n.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},
_fixFieldCase:function(a,b,c){var d=a&&a[b],f;if(d&&!p.isFunction(d)){if(f=!this._getField(d)&&this._getField(d,!0))d=a[b]=f.name;c&&c.push(d)}return d},_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;if(a&&0<this.fields.length){var b=[],c,a=e.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],n.isDefined),d=[].concat(a);e.forEach(a,function(a){e.forEach(a.rendererInfos,function(a){a.renderer&&d.push(a.renderer)})});e.forEach(d,function(a){this._fixFieldCase(a,
"attributeField",b);this._fixFieldCase(a,"attributeField2",b);this._fixFieldCase(a,"attributeField3",b);this._fixFieldCase(a.rotationInfo,"field",b);if((c=this._fixFieldCase(a.sizeInfo,"field",b))&&!this._orderBy)this._orderBy=[c+" DESC"];this._fixFieldCase(a.sizeInfo,"normalizationField",b);this._fixFieldCase(a.colorInfo,"field",b);this._fixFieldCase(a.colorInfo,"normalizationField",b);this._fixFieldCase(a.field,"field",b);this._fixFieldCase(a.opacityInfo,"field",b);this._fixFieldCase(a.opacityInfo,
"normalizationField",b);e.forEach(a.visualVariables,function(a){c=this._fixFieldCase(a,"field",b);"sizeInfo"===a.type&&(c&&!this._orderBy)&&(this._orderBy=[c+" DESC"]);this._fixFieldCase(a,"normalizationField",b)},this);if(!this._orderBy&&a.addBreak&&!p.isFunction(a.attributeField)&&(a.backgroundFillSymbol||this._hasSizeDiff(a)))this._orderBy=[a.attributeField+" DESC"]},this);this._rendererFields=e.filter(b,n.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d,f;e.forEach(a.infos,
function(a){if(f=a.symbol){d=0;switch(f.type){case "simplemarkersymbol":d=f.size;break;case "picturemarkersymbol":d=(f.width+f.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":d=f.width;break;case "simplefillsymbol":case "picturefillsymbol":d=f.outline&&f.outline.width}d&&(b=Math.min(b,d),c=Math.max(c,d))}});return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&
a?e.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=this.fields;if(!c||0===c.length)return null;var d;b&&(a=a.toLowerCase());e.some(c,function(c){var f=!1;(f=b?c&&c.name.toLowerCase()===a?!0:!1:c&&c.name===a?!0:!1)&&(d=c);return f});return d},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:e.map(e.filter(this.fields,function(a){return!!(a&&"esriFieldTypeDate"===a.type)}),function(a){return a.name})});return this._dtOpts},
_applyNormalized:function(a,b){a&&b&&e.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,b,c,d,f,h){f=a.addResults;var k=a.updateResults;a=a.deleteResults;var n,g,l,m,q=this.objectIdField,t=this._mode,r=this._isTable;n=this.editFieldsInfo;var w=this.getOutFields()||[],u=n&&n.creatorField,D=n&&n.creationDateField,s=n&&n.editorField,v=n&&n.editDateField;n=n&&n.realm;-1===e.indexOf(w,"*")&&(u&&-1===e.indexOf(w,u)&&(u=null),D&&-1===e.indexOf(w,D)&&(D=null),s&&-1===e.indexOf(w,
s)&&(s=null),v&&-1===e.indexOf(w,v)&&(v=null));var w=D||v?(new Date).getTime():null,x=u||s?this.getUserId():void 0;x&&n&&(x=x+"@"+n);if(f)for(n=0;n<f.length;n++)f[n]=new R(f[n]),r||(g=f[n],g.success&&(g=g.objectId,l=b[n],(m=l._graphicsLayer)&&m!==this&&m.remove(l),m=l.attributes||{},m[q]=g,u&&(m[u]=x),s&&(m[s]=x),D&&(m[D]=w),v&&(m[v]=w),l.setAttributes(m),t._init&&t.drawFeature(l)));if(k)for(n=0;n<k.length;n++)if(k[n]=new R(k[n]),!r&&(g=k[n],g.success)){g=g.objectId;l=c[g];if(b=t._getFeature(g))b.geometry!==
l.geometry&&l.geometry&&b.setGeometry(A.fromJson(l.geometry.toJson())),b.attributes!==l.attributes&&l.attributes&&b.setAttributes(p.mixin(b.attributes,l.attributes)),this._repaint(b,g);l=b||l;m=l.attributes||{};s&&(m[s]=x);v&&(m[v]=w);l.setAttributes(m)}if(a){c=[];for(n=0;n<a.length;n++)if(a[n]=new R(a[n]),!r&&(g=a[n],g.success&&(g=g.objectId,l=t._getFeature(g))))this._unSelectFeatureIIf(g,t)&&c.push(l),l._count=0,t._removeFeatureIIf(g);if(0<c.length)this.onSelectionComplete(c,K.SELECTION_SUBTRACT)}this._resolve([f,
k,a],"onEditsComplete",d,h)},_sendAttachment:function(a,b,c,d,f){var e=this;return w({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),form:c,content:p.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var f="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";c=new R(c["add"===a?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=b;e._resolve([c],
f,d);return c}).addErrback(function(a){e._resolve([a],null,f,null,!0)})},_repaint:function(a,b,c){b=n.isDefined(b)?b:a.attributes[this.objectIdField];(!(b in this._selectedFeatures)||!this._selectionSymbol)&&a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;return b?b.isLatestObservation(a)?1:0:0}});p.mixin(K,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",
POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});z._createWrappers(K);l("extend-esri")&&p.setObject("layers.FeatureLayer",K,a);return K})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),function(q,m,g,r,p,e,s,k,f,l,b){q=q(null,{declaredClass:"esri.layers.FeatureType",constructor:function(c){if(c&&
m.isObject(c)){this.id=c.id;this.name=c.name;var d=c.symbol;d&&(this.symbol=s.fromJson(d));var d=c.domains,e,g=this.domains={};for(e in d)if(d.hasOwnProperty(e)){var a=d[e];switch(a.type){case "range":g[e]=new k(a);break;case "codedValue":g[e]=new f(a);break;case "inherited":g[e]=new l(a)}}if(e=c.templates){d=this.templates=[];for(c=0;c<e.length;c++)d.push(new b(e[c]))}}},toJson:function(){var b={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},d,f=this.domains,k=this.templates,
a=e.fixJson;if(f){var n=b.domains={};for(d in f)f.hasOwnProperty(d)&&(n[d]=f[d]&&f[d].toJson());a(n)}k&&(b.templates=g.map(k,function(a){return a.toJson()}));return a(b)}});r("extend-esri")&&m.setObject("layers.FeatureType",q,p);return q})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(q,m,g,r,p,e){q=q(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(g){g&&m.isObject(g)&&(this.name=
g.name,this.description=g.description,this.drawingTool=g.drawingTool,this.thumbnail=g.thumbnail,g=g.prototype,this.prototype=new e(g.geometry,null,g.attributes))},toJson:function(){return p.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:p.fixJson(m.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});m.mixin(q,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",
TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});
g("extend-esri")&&m.setObject("layers.FeatureTemplate",q,r);return q})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,m,g,r){q=q(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(g){g&&m.isObject(g)&&(this.objectId=g.objectId,this.success=g.success,g.success||(g=g.error,this.error=Error(),this.error.code=g.code,this.error.message=g.description))}});g("extend-esri")&&m.setObject("layers.FeatureEditResult",
q,r);return q})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),function(q,m,g,r,p,e,s){q=q([s],{declaredClass:"esri.layers._SnapshotMode",constructor:function(e){this.featureLayer=e;this.pagination=e.queryPagination;this._featureMap={};this._hasPartialFeatures=!1;this._drawFeatures=m.hitch(this,this._drawFeatures);this._queryErrorHandler=m.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=
this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(e){this._init&&(e?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(e){var f=e.attributes[this.featureLayer.objectIdField];
this._addFeatureIIf(f,e);this._incRefCount(f)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var e=this.featureLayer;e._collection?(e._fireUpdateStart(),e._refresh(!0),e._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},_getRequestId:function(e){return("_"+e.name+e.layerId+e._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var e=this.featureLayer;!e._collection&&!e.suspended&&(e._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=
!1,this._sendRequest())},_sendRequest:function(g){var f=this.map,l=this.featureLayer,b=l.getDefinitionExpression(),c=new e;c.outFields=l.getOutFields();c.where=b||"1\x3d1";c.returnGeometry=!0;c.outSpatialReference=new p(f.spatialReference.toJson());c.timeExtent=l.getTimeDefinition();c.maxAllowableOffset=l._maxOffset;c.quantizationParameters=l._quantizationParameters;l._ts&&(c._ts=(new Date).getTime());c.orderByFields=l.supportsAdvancedQueries?l.getOrderByFields():null;c.multipatchOption=l.multipatchOption;
this.pagination&&(this._start=c.start=null==g?0:g,c.num=l.maxRecordCount);var d;l._usePatch&&(d=this._getRequestId(l),this._cancelPendingRequest(null,d));l._task.execute(c,this._drawFeatures,this._queryErrorHandler,d)},_drawFeatures:function(e){this._purgeRequests();var f=e.features,g=this.featureLayer,b=g.objectIdField,c,d=f.length,h=e.exceededTransferLimit&&!g._collection,m=g._selectedFeatures,a=g.mode===g.constructor.MODE_AUTO,n,q,p;g._fireUpdateStart();g._sortFeatures(f);for(c=0;c<d;c++)q=f[c],
p=q.attributes[b],n=this._addFeatureIIf(p,q),this._incRefCount(p),a&&(n!==q&&m[p])&&(n.setGeometry(q.geometry),n.setAttributes(q.attributes));this._applyTimeFilter(!0);if(!this.pagination||!h)this._hasPartialFeatures=!!e.exceededTransferLimit,g._fireUpdateEnd(null,e.exceededTransferLimit?{queryLimitExceeded:!0}:null);h&&(this.pagination&&this._sendRequest(this._start+g.maxRecordCount),g.onQueryLimitExceeded())},_queryErrorHandler:function(e){this._purgeRequests();this._hasPartialFeatures=!0;var f=
this.featureLayer;f._errorHandler(e);f._fireUpdateEnd(e)}});g("extend-esri")&&m.setObject("layers._SnapshotMode",q,r);return q})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),function(q,m,g,r,p,e,s){m=m(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(q._scopeName||"dojo")+"IoScript"},initialize:function(e){this.map=e;this._init=!0},startup:function(){},
propertyChangeHandler:function(e){},destroy:function(){this._init=!1},drawFeature:function(e){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},_incRefCount:function(e){(e=this._featureMap[e])&&e._count++},_decRefCount:function(e){(e=this._featureMap[e])&&e._count--},_getFeature:function(e){return this._featureMap[e]},_addFeatureIIf:function(e,f){var g=this._featureMap,b=g[e],c=this.featureLayer;b||(g[e]=f,c._add(f),f._count=0);return b||f},_removeFeatureIIf:function(e){var f=
this._featureMap[e],g=this.featureLayer;if(f){if(f._count)return;delete this._featureMap[e];g._remove(f)}return f},_clearIIf:function(){var e;e=this.featureLayer;var f=e.graphics,g=e._selectedFeatures,b=e.getSelectedFeatures().length,c=e.objectIdField;if(b)for(e=f.length-1;0<=e;e--){var b=f[e],d=b.attributes[c];d in g?b._count=1:(b._count=0,this._removeFeatureIIf(d))}else e.clear(),this._featureMap={}},_isPending:function(g){return e[this._prefix+g]?!0:!1},_cancelPendingRequest:function(g,f){if(g=
g||e[this._prefix+f])try{g.cancel(),e._validCheck(g)}catch(l){}},_purgeRequests:function(){e._validCheck(null)},_toggleVisibility:function(e){var f=this.featureLayer,g=f.graphics,b=e?"show":"hide",c,d=g.length;e=e&&f._ager;for(c=0;c<d;c++){var h=g[c];h[b]();e&&f._repaint(h)}},_applyTimeFilter:function(e){var f=this.featureLayer;if(f.timeInfo&&!f.suspended){e||f._fireUpdateStart();var g=f._trackManager;g&&g.clearTracks();var b=f.getTimeDefinition(),c=f._getOffsettedTE(f._mapTimeExtent);c?(c=f._getTimeOverlap(b,
c))?(b=f._filterByTime(f.graphics,c.startTime,c.endTime),g&&g.addFeatures(b.match),r.forEach(b.match,function(b){var c=b._shape;b.visible||(b.show(),(c=b._shape)&&c._moveToFront());f._ager&&c&&f._repaint(b)}),r.forEach(b.noMatch,function(b){b.visible&&b.hide()})):this._toggleVisibility(!1):(g&&g.addFeatures(f.graphics),this._toggleVisibility(!0));g&&(g.moveLatestToFront(),g.drawTracks());e||f._fireUpdateEnd()}}});p("extend-esri")&&g.setObject("layers._RenderMode",m,s);return m})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),
function(q,m,g,r,p,e,s,k,f,l){q=q([f],{declaredClass:"esri.layers._OnDemandMode",constructor:function(b){this.featureLayer=b;this._featureMap={};this._hasPartialFeatures=!1;this._queryErrorHandler=g.hitch(this,this._queryErrorHandler)},initialize:function(b){this.inherited(arguments);var c=this.featureLayer,d=c._srInfo;this._gridLayer=new l(new s(d?d.valid[0]:b.extent.xmin,d?d.valid[1]:b.extent.ymax,b.spatialReference),{width:c._tileWidth,height:c._tileHeight},{width:b.width,height:b.height},d);this._cellMap=
{};this._gridLayer.setResolution(b.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(b){this._init&&(2>b?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(b){var c=this._gridLayer,
d=b.geometry,e=[];if(d)for(var e=c.getCellsInExtent("point"===d.type?{xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y}:d.getExtent(),!1).cells,c=this._cellMap,f,a=b.attributes[this.featureLayer.objectIdField],g,k,l,d=0;d<e.length;d++)f=e[d],g=f.latticeID,k=f.row,l=f.col,g?f=c[g]=c[g]||f:(c[k]=c[k]||{},f=c[k][l]=c[k][l]||f),f.features=f.features||[],f.features.push(b),this._addFeatureIIf(a,b),this._incRefCount(a)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),
this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){if(this._hasPartialFeatures)return!0;var b=!1,c=this._getCurrentCells(),d;for(d=0;d<c.length;d++)if(c[d].hasPartialFeatures){b=!0;break}return!b},_enableConnectors:function(){var b=this.map;this._zoomConnect=m.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=m.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=m.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){m.disconnect(this._zoomConnect);
m.disconnect(this._panConnect);m.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,c=this.map;b.suspended||(b._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(c.extent),this._sendRequest())},_panHandler:function(b){this.featureLayer._fireUpdateStart();var c=this.featureLayer._resized;b=c?b:null;c&&this._gridLayer.setMapState(b,this.map.width,this.map.height);
this._sendRequest(b)},_getRequestId:function(b,c){return("_"+b.name+b.layerId+b._ulid+"_"+c.resolution+"_"+(c.latticeID||c.row+"_"+c.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(b){this._exceeds=!1;var c=this.featureLayer,d=this.map;b=b||d.extent;d=this._gridLayer.getCellsInExtent(b,c.latticeTiling).cells;if(!c.isEditable())var f=this._cellMap,d=r.filter(d,function(a){if(a.lattice){if(f[a.latticeID])return!1}else if(f[a.row]&&f[a.row][a.col])return!1;return!0});var e=c.getOutFields(),
a=c.getDefinitionExpression(),g=c._getOffsettedTE(c._mapTimeExtent),l=c.supportsAdvancedQueries?c.getOrderByFields():null,m=c._usePatch,q=this._ioQueue,p,s=this,x=this._drawFeatures,y,H,I;this._pending=this._pending||0;for(p=0;p<d.length;p++){y=d[p];H=new k;H.geometry=y.extent||y.lattice;H.outFields=e;H.where=a;c.latticeTiling&&y.extent&&(H.spatialRelationship=k.SPATIAL_REL_CONTAINS);H.returnGeometry=!0;H.timeExtent=g;c._ts&&(H._ts=(new Date).getTime());H.orderByFields=l;H.multipatchOption=c.multipatchOption;
H.maxAllowableOffset=c._maxOffset;H.quantizationParameters=c._quantizationParameters;if((I=c.advancedQueryCapabilities)&&I.supportsQueryWithResultType)H.resultType="tile";I=null;if(m&&(I=this._getRequestId(c,y),this._isPending(I)))continue;this._pending++;q.push(c._task.execute(H,function(){var a=y;return function(b){x.apply(s,[b,a])}}.call(this),this._queryErrorHandler,I))}this._removeOldCells(b);this._endCheck()},_drawFeatures:function(b,c){c.hasPartialFeatures=!!b.exceededTransferLimit;this._exceeds=
this._exceeds||b.exceededTransferLimit;this._finalizeIO();var d=this.featureLayer,f=this.map.extent,e=c.extent,a=c.row,g=c.col,k=d.objectIdField,l=b.features,m=this._gridLayer,q=this._cellMap,p=c.latticeID,r=p?q[p]:q[a]&&q[a][g];if(c.resolution!=m._resolution||(p?p!==m.getLatticeID(f):!m.intersects(e,f)))r&&this._removeCell(a,g,p);else if(r)d._sortFeatures(l),this._updateCell(r,l);else{d._sortFeatures(l);c.features=l;p?q[p]=c:(q[a]=q[a]||{},q[a][g]=c);f=l.length;for(d=0;d<f;d++)e=l[d],a=e.attributes[k],
this._addFeatureIIf(a,e),this._incRefCount(a)}this._endCheck()},_queryErrorHandler:function(b){this._finalizeIO();this._hasPartialFeatures=!0;this.featureLayer._errorHandler(b);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var c=this.featureLayer,d=c._trackManager;d&&(d.clearTracks(),d.addFeatures(c.graphics),c._ager&&r.forEach(c.graphics,function(b){b._shape&&c._repaint(b)}),d.moveLatestToFront(),
d.drawTracks());this.featureLayer._fireUpdateEnd(b&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)c.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=r.filter(this._ioQueue,function(b){return-1<b.fired?!1:!0});b&&r.forEach(this._ioQueue,this._cancelPendingRequest)},_getCurrentCells:function(b){var c=[];b=b||this._cellMap;for(var d in b)if(b.hasOwnProperty(d)){var f=b[d];f&&(f.hasOwnProperty("row")||f.hasOwnProperty("latticeID")?
c.push(f):"object"===typeof f&&c.push.apply(c,this._getCurrentCells(f)))}return c},_removeOldCells:function(b){var c=this._cellMap,d=this._gridLayer,f,e;for(f in c)if(c[f]){var a=c[f],g=a.latticeID,l=0,k=0;if(g)l++,g!==d.getLatticeID(b)&&(this._removeCell(null,null,g),k++);else for(e in a)a[e]&&(l++,d.intersects(a[e].extent,b)||(this._removeCell(f,e),k++));k===l&&delete c[f]}},_updateCell:function(b,c){var d=this.featureLayer,f=d.objectIdField,d=d._selectedFeatures,e,a=c.length;b.features=b.features||
[];for(e=0;e<a;e++){var g=c[e],l=g.attributes[f],k=this._addFeatureIIf(l,g);k===g?(this._incRefCount(l),b.features.push(k)):l in d||(k.setGeometry(g.geometry),k.setAttributes(g.attributes))}},_removeCell:function(b,c,d){var f=this._cellMap,e=this.featureLayer,a=e.objectIdField,g=d?f[d]:f[b]&&f[b][c];if(g){d?delete f[d]:delete f[b][c];b=g.features;for(c=0;c<b.length;c++)d=b[c].attributes[a],this._decRefCount(d),d in e._selectedFeatures||this._removeFeatureIIf(d)}}});p("extend-esri")&&g.setObject("layers._OnDemandMode",
q,e);return q})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),function(q,m,g,r,p,e,s,k){q=q(null,{declaredClass:"esri.layers._GridLayout",constructor:function(f,e,b,c){this.origin=f;this.cellWidth=e.width;this.cellHeight=e.height;this.mapWidth=b.width;this.mapHeight=b.height;this.srInfo=c},setResolution:function(f){this._resolution=(f.xmax-f.xmin)/this.mapWidth;
this.srInfo&&(f=Math.round(2*this.srInfo.valid[1]/this._resolution),f=Math.round(f/this.cellWidth),this._frameStats=[f,0,f-1])},setMapState:function(f,e,b){this.mapWidth=e;this.mapHeight=b;this.setResolution(f)},getCellCoordinates:function(f){var e=this._resolution,b=this.origin;return{row:Math.floor((b.y-f.y)/(this.cellHeight*e)),col:Math.floor((f.x-b.x)/(this.cellWidth*e))}},normalize:function(f){var e=this._frameStats;if(e){var b=e[0],c=e[1],e=e[2];f<c?(f%=b,f=f<c?f+b:f):f>e&&(f%=b)}return f},
intersects:function(e,k){var b=this.srInfo;return b?g.some(k._getParts(b),function(b){return e.intersects(b.extent)}):e.intersects(k)},getCellExtent:function(f,g){var b=this._resolution,c=this.origin,d=this.cellWidth,h=this.cellHeight;return new s(g*d*b+c.x,c.y-(f+1)*h*b,(g+1)*d*b+c.x,c.y-f*h*b,new e(c.spatialReference.toJson()))},getLatticeID:function(e){var g=this.getCellCoordinates({x:e.xmin,y:e.ymax}),b=this.getCellCoordinates({x:e.xmax,y:e.ymin});e=g.row;var c=b.row,g=this.normalize(g.col),b=
this.normalize(b.col);return e+"_"+c+"_"+g+"_"+b},sorter:function(e,g){return e<g?-1:1},getCellsInExtent:function(e,l){var b=this.getCellCoordinates({x:e.xmin,y:e.ymax}),c=this.getCellCoordinates({x:e.xmax,y:e.ymin}),d=b.row,h=c.row,b=b.col,c=c.col,m=[],a,n,q,p=[],r=[],s,v,x,y,H=[];for(a=d;a<=h;a++)for(n=b;n<=c;n++)q=this.normalize(n),e=this.getCellExtent(a,q),g.some(m,function(b){return b.row===a&&b.col===q})||m.push({row:a,col:q,extent:e,resolution:this._resolution}),l&&(p.push(e.xmin,e.xmax),r.push(e.ymin,
e.ymax));b=this.normalize(b);c=this.normalize(c);p.sort(this.sorter);r.sort(this.sorter);n=p.length;for(a=n-1;0<=a;a--)a<n-1&&p[a]===p[a+1]&&p.splice(a,1);n=r.length;for(a=n-1;0<=a;a--)a<n-1&&r[a]===r[a+1]&&r.splice(a,1);if(p.length&&r.length){s=p[0];v=p[p.length-1];x=r[0];y=r[r.length-1];n=p.length;for(a=0;a<n;a++)H.push([[p[a],y],[p[a],x]]);n=r.length;for(a=0;a<n;a++)H.push([[s,r[a]],[v,r[a]]]);p=new k({paths:H,spatialReference:this.origin.spatialReference.toJson()});m.push({latticeID:d+"_"+h+"_"+
b+"_"+c,lattice:p,resolution:this._resolution})}return{minRow:d,maxRow:h,minCol:b,maxCol:c,cells:m}}});r("extend-esri")&&m.setObject("layers._GridLayout",q,p);return q})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(q,m,g,r,p){q=q([p],{declaredClass:"esri.layers._SelectionMode",constructor:function(e){this.featureLayer=e;this._featureMap={}},propertyChangeHandler:function(e){this._init&&0===e&&this._applyTimeFilter()},
resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures}});g("extend-esri")&&m.setObject("layers._SelectionMode",q,r);return q})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(q,m,g,r,p,e,s,k,f,l){q=q([l],{declaredClass:"esri.layers._StreamMode",constructor:function(b,
c){this.featureLayer=b;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=m.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;b.purgeOptions&&(b.purgeOptions.age&&"number"===typeof b.purgeOptions.age)&&(this._maxFeatureAge=1E3*Math.ceil(60*b.purgeOptions.age));this._drawFeatures=m.hitch(this,this._drawFeatures);this._queryErrorHandler=m.hitch(this,this._queryErrorHandler)},
startup:function(){},propertyChangeHandler:function(b){this._init&&(0===b?this._applyTimeFilter():3===b?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(b){var c=this.featureLayer,d=c.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,
this._refreshRate));c._joinField&&this._getFeature(b.attributes[d])?this._drawBuffer.updates.push({oid:b.attributes[d],updates:b}):this._drawBuffer.adds.push(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var b=this.featureLayer;b&&(!b._relatedUrl&&!b._keepLatestUrl?(b._fireUpdateStart(),b.clear(),b._fireUpdateEnd()):(b._fireUpdateStart(),b._refreshing=!0,b.disconnect(),b.clear(),b._relatedQueried=!1,b._keepLatestQueried=!1,b.connect()))},_drawFeatures:function(b,c){this._purgeRequests();
var d=this.featureLayer;d._create(b.features||[]);d._fireUpdateEnd(null,c)},_applyTimeFilter:function(b){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(b){var c=this.featureLayer,d=c.objectIdField;b&&g.forEach(b,function(b){b=b.attributes[d];c._unSelectFeatureIIf(b,this);this._decRefCount(b);this._removeFeatureIIf(b)},this)},_addFeatures:function(b){var c=this.featureLayer,d=c._endTimeField,e=c._startTimeField,f,a,n,k=[],l=[],m=[];f=c._trackManager;a=c.objectIdField;if(f)for(n in b=
f.addFeatures(b),b)b.hasOwnProperty(n)&&(k.push(n),b[n].adds&&(l=l.concat(b[n].adds)),b[n].deletes&&(m=m.concat(b[n].deletes)));else l=b;g.forEach(l,function(b){var c=b.attributes[a],f;f=d&&b.attributes[d];!f&&this._maxFeatureAge&&(f=e&&b.attributes[e]?b.attributes[e]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);f&&(f=1E3*Math.ceil(f/1E3),this._featuresByTime[f]?this._featuresByTime[f].push(c):this._featuresByTime[f]=[c]);this._addFeatureIIf(c,b);this._incRefCount(c)},this);m.length&&this._removeFeatures(m);
f&&f.refreshTracks(k)},_updateFeatures:function(b){var c=this.featureLayer,d,e,f=[];d=c._trackManager;e=c._trackIdField;g.forEach(b,function(a){var b=a.updates;a=this._getFeature(a.oid);var g;if(a){b.geometry&&a.setGeometry(b.geometry);b=b.attributes||{};for(g in b)b.hasOwnProperty(g)&&(a.attributes[g]=b[g]);a.visible=this._checkFeatureTimeIntersects(a);d&&a.attributes[e]?f.push(a.attributes[e]):c._repaint(a,null,!0)}},this);f.length&&d.refreshTracks(f)},_redrawAllTracks:function(){var b=this.featureLayer._trackManager,
c;if(b&&(c=b.trimTracks())&&0<c.length)this._removeFeatures(c),b.refreshTracks()},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var b=this._drawBuffer,c=b.adds.splice(0,b.adds.length),d=b.updates.splice(0,b.updates.length),b=this.featureLayer;if(!b)return!1;b.updating||b._fireUpdateStart();this._addFeatures(c);this._updateFeatures(d);if((c=this._getExpiredFeatures())&&c.length)this._removeFeatures(c),b._trackManager&&b._trackManager.removeFeatures(c);b._purge();b._fireUpdateEnd();this._timeoutId=
null},_clearDrawBuffer:function(){var b=this._timeoutId,c=this._drawBuffer,d=c.adds,c=c.updates;b&&clearTimeout(b);d.splice(0,d.length);c.splice(0,c.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(b){b=b||0===b?b:200;0>b&&(b=200);this._refreshRate=b},_checkFeatureTimeIntersects:function(b){var c=this.featureLayer,d=c.getMap(),d=d?d.timeExtent:
null;return!d||!c.timeInfo||!c.timeInfo.startTimeField&&!c.timeInfo.endTimeField?!0:0<c._filterByTime([b],d.startTime,d.endTime).match.length},_getRequestId:function(b){return("_"+b.name+b.layerId+b._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(b){function c(b){p++;l.execute(a).then(function(a){b(null,a)},function(a){b(a)})}function d(b,e){if(b)p>=r||!g._relatedUrl?v._queryErrorHandler(Error("Could not get features from related feature service")):(x={relatedFeatureWarning:"Querying related feature service using the current filter failed. All related features are displayed, and the filter is applied to the stream service only"},
a.where="1\x3d1",c(d));else{var f=v._fixFieldNameCasing(g,e);e.features=f;v._drawFeatures(e,x)}}var g=this.featureLayer,l,a,n,m,q;g._fireUpdateStart();if(b&&this.map){l=new k(b);a=new s;b=this.map;n=g.getFilter()||{};m=n.where||"1\x3d1";q=n.geometry?f.fromJson(n.geometry):null;n=n.outFields?n.outFields.split(","):["*"];a.geometry=q;a.where=m;a.outFields=n;a.returnGeometry=!0;a.outSpatialReference=new e(b.spatialReference.toJson());g._usePatch&&(b=this._getRequestId(g),this._cancelPendingRequest(null,
b));var p=0,r=2,v=this,x=null;c(d)}else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),!1},_queryErrorHandler:function(b){this._purgeRequests();var c=this.featureLayer;c._errorHandler(b);c._fireUpdateEnd(b)},_fixFieldNameCasing:function(b,c){var d=c.features||[],e=c.fields;if(!e||!d.length)return d;for(var e=this._mapFieldNameDifferences(b.fields,e),f=[],a,g,k=0,l=c.features.length;k<l;k++)a=d[k],g=this._swizzleResponseAttributes(a.attributes,
e),f.push({geometry:a.geometry,attributes:g});return f},_mapFieldNameDifferences:function(b,c){var d=[],e={},f,a;f=0;for(a=c.length;f<a;f++)d.push(c[f].name);f=0;for(a=b.length;f<a;f++){var g=b[f].name,k=this._checkForStreamFieldName(g,d);k&&(e[k]=g)}return e},_checkForStreamFieldName:function(b,c){for(var d=b.toLowerCase(),e,f=0,a=c.length;f<a;f++)if(c[f].toLowerCase()===d){e=c[f];break}return e},_swizzleResponseAttributes:function(b,c){var d={},e;for(e in b)if(b.hasOwnProperty(e)){var f=b[e];c.hasOwnProperty(e)?
d[c[e]]=f:d[e]=f}return d},_getExpiredFeatures:function(){var b,c,d,e=[],f=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return f;b=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=c=1E3*Math.ceil(Date.now()/1E3);if(b&&b!==c)for(d=this._featuresByTime;b<=c;b+=1E3)d[b]&&(e=e.concat(d[b]),delete d[b]);g.forEach(e,function(a){(a=this._getFeature(a))&&f.push(a)},this);return f}});r("extend-esri")&&m.setObject("layers._StreamMode",q,p);return q})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),
function(q,m,g,r,p,e,s,k){q=q(null,{declaredClass:"esri.layers._TrackManager",constructor:function(e){this.layer=e;this.trackMap={};this.trackLineMap={}},initialize:function(e){this.map=e;var g=this.layer,b=g._getRenderer(),b=b&&b.trackRenderer;if("esriGeometryPoint"===g.geometryType){var c=this.container=new k._GraphicsLayer({id:g.id+"_tracks",_child:!0,visible:g.visible,minScale:g.minScale,maxScale:g.maxScale});c.loaded=!0;c.onLoad(c);c._setMap(e,g._div);c.setRenderer(b);g.on("visibility-change",
m.hitch(this,function(b){this.container.setVisibility(b.visible);this.container.evaluateSuspension()}));g.on("scale-range-change",m.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))}},addFeatures:function(e){var k=this.trackMap,b=this.layer,c=b._trackIdField,d=[];g.forEach(e,function(a){var b=a.attributes[c];(k[b]=k[b]||[]).push(a);-1===g.indexOf(d,b)&&d.push(b)});var h=b._startTimeField,m=b.objectIdField,a=function(a,b){var c=a.attributes[h],d=b.attributes[h];
return c===d?a.attributes[m]<b.attributes[m]?-1:1:c<d?-1:1};g.forEach(d,function(b){k[b].sort(a)})},trimTracks:function(e){function k(e){for(e=b[e]||[];e.length>c;)d.push(e.shift())}var b=this.trackMap,c=this.layer.maximumTrackPoints||0,d=[],h;if(!c)return d;if(e)g.forEach(e,function(b){k(b)});else for(h in b)b.hasOwnProperty(h)&&k(h);return d},drawTracks:function(f){function k(a){var f=d[a],g,l,q;l=b.trackLineMap[a];c.remove(l);delete b.trackLineMap[a];if(!f||2>f.length)return!1;l=[];for(g=f.length-
1;0<=g;g--)(q=f[g].geometry)&&l.push([q.x,q.y]);f={};f[m]=a;1<l.length&&(l=new e(new s({paths:[l],spatialReference:h}),null,f),c.add(l),b.trackLineMap[a]=l)}var b=this,c=this.container,d,h,m,a;if(c)if(d=this.trackMap,h=this.map.spatialReference,m=this.layer._trackIdField,f)g.forEach(f,function(a){k(a)});else for(a in d)d.hasOwnProperty(a)&&k(a)},refreshTracks:function(e){function k(a){var e,f;b.drawTracks([a]);if(h&&h.latestObservationRenderer){a=c[a]||[];e=a.length;for(f=0;f<e;f++)d._repaint(a[f],
null,!0)}}var b=this,c=this.trackMap,d=this.layer,h=d._getRenderer(),m;if(e)g.forEach(e,function(a){k(a)});else for(m in c)c.hasOwnProperty(m)&&k(m);this.moveLatestToFront()},moveLatestToFront:function(e){g.forEach(this.getLatestObservations(e),function(e){var b=e._shape;b&&b._moveToFront();this._repaint(e,null,!0)},this.layer)},getLatestObservations:function(e){function k(b){b=d[b];return b[b.length-1]}var b=[],c=this.layer._getRenderer(),d=this.trackMap,h;if(!c.latestObservationRenderer)return b;
if(e)g.forEach(e,function(c){b.push(k(c))});else for(h in d)d.hasOwnProperty(h)&&b.push(k(h));return b},clearTracks:function(e){var k=this.getLatestObservations(e),b=this.container,c;e?g.forEach(e,function(d){delete this.trackMap[d];b&&(c=this.trackLineMap[d],b.remove(c),delete this.trackLineMap[d])},this):(this.trackMap={},this.trackLineMap={},b&&b.clear());g.forEach(k,function(b){this._repaint(b,null,!0)},this.layer)},isLatestObservation:function(e){var g=this.trackMap[e.attributes[this.layer._trackIdField]];
return g?g[g.length-1]===e:!1},destroy:function(){var e=this.container;e&&(e.clear(),e._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});r("extend-esri")&&m.setObject("layers._TrackManager",q,p);return q})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(q,m,g,r,p,e,s,k,f,l,b,c,d){function h(){}function t(a){var b=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return b}}}q=q(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var c=this.sourceLayer,d=c.renderer;c.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var e=this;this.heatmapRenderer=
d instanceof b?d:(d.getRendererInfoByZoom(a.getZoom())||d.getRendererInfoByScale(a.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=
this._reprojectFeature.bind(this);p(["../workers/heatmapCalculator"],function(a){e._calculator=new a(m.mixin({width:e.map.width,height:e.map.height},e._getOptions()));e._setupRenderer();e.heatmapRenderer.getStats=a.calculateStats;e.heatmapRenderer.getHistogramData=a.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},
_handleRendererChange:function(a){var c=a.renderer,d=c instanceof b;this.heatmapRenderer?d?this.heatmapRenderer=c:this._removeRenderer(a):d&&(this.heatmapRenderer=c,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var b=this._getImageBySourceId(this.sourceLayer.id);b&&b.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,b=this.sourceLayer,c=this.map,d=this;b._originalDraw=b._draw;b._draw=h;b._div.clear();clearTimeout(this._resetTimer);this._resetTimer=
setTimeout(this._resetGraphics.bind(this),250);a.push(b.on("update-end",this._setupDraw));a.push(b.on("suspend",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.hide()}));a.push(b.on("resume",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.show()}));a.push(g.after(b,"redraw",this._setupDraw));a.push(c.on("layer-remove",function(a){a.layer==b&&((a=d._getImageBySourceId(d.sourceLayer.id))&&d.imageLayer.removeImage(a),d._removeRenderer({target:b}))}));b._collection&&a.push(b.on("graphic-add",
function(a){d._reprojectFeature(a.graphic);d._setupDraw()}));1!==b.mode&&(a.push(c.on("resize, pan-end",this._setupDraw)),a.push(c.on("zoom-end",this._setupDraw)));a.push(b.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();b.graphics&&b.graphics.length&&(b.graphics[0].geometry&&!c.spatialReference.equals(b.graphics[0].geometry.spatialReference)&&r.forEach(b.graphics,function(a){this._reprojectFeature(a)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var a=
this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(b)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var b=a.target;b._draw=b._originalDraw;delete b._originalDraw;b.setDrawMode(!0);this._removeHandlers();this._hndls=[];var c=this._getImageBySourceId(this.sourceLayer.id);c&&this.imageLayer.removeImage(c);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;b.renderer!=
a.renderer&&b.renderer.getRendererInfo?this.heatmapRenderer=null:(b.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var b=a.geometry,c=this.map.spatialReference;c.equals(b.spatialReference)||(b=f.project(b,c),null==b?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=
b)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var a=this.sourceLayer,b=this.map,d=this.heatmapRenderer,e=this.map.extent,f=this.map.width,g=this.map.height,h=this._calculator,k=this,q=function(c){c=k._getScreenPoints(c.features,b,a);c=h.calculateImageData(m.mixin({screenPoints:c,mapinfo:{extent:[e.xmin,e.ymin,e.xmax,e.ymax],resolution:b.getResolution()},width:f,height:g},k._getOptions()));c=d.getSymbol(t({geometry:b.extent,attributes:{size:[f,g],imageData:c},layer:a}));c=new l({extent:b.extent,
href:c.url,opacity:0,sourceId:a.id});k._swapMapImages(c,k._getImageBySourceId(a.id));a.suspended&&c.hide()},p={geometry:b.extent,timeExtent:a.useMapTime?b.timeExtent:void 0,spatialRelationship:c.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(p)?a.queryFeatures(p,q):q({features:a.graphics})},_getScreenPoints:function(a,b,c){var d=[],e=a.length,f=0,g=0,h,m=new k(b.extent.xmin,b.extent.ymax,b.spatialReference),l=b.toScreen(m),q=l.x,l=l.y,p=b.getResolution(),s;for((g=b.extent.getCacheValue("_parts"))&&
(s=r.map(g,function(a){return c._intersects(b,a.extent)[0]}));e--;)g=a[e],g.geometry&&(h={x:Math.ceil((g.geometry.x-m.x)/p+q),y:Math.floor((m.y-g.geometry.y)/p-l),attributes:g.attributes},s&&(g=1<s.length&&h.x<-s[0]?s[1]:s[0],h.x+=g),d[f++]=h);return d},_getImageBySourceId:function(a){var b=this.imageLayer.getImages(),b=r.filter(b,function(b){return b.sourceId==a});if(b.length)return b[b.length-1]},_swapMapImages:function(a,b){function c(){e.removeImage(b)}var e=this.imageLayer,f=this.sourceLayer.opacity||
1;e.addImage(a);d.anim(a._node,{opacity:f},null,null,function(){a.opacity=f});null!=b&&d.anim(b._node,{opacity:0},null,null,c)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var a=this.sourceLayer.graphics,b=a.length,c;b--;)c=a[b],c._shape=c._offsets=void 0}});s("extend-esri")&&m.setObject("layers.HeatmapManager",q,e);return q})},"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff ../kernel ../config ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(q,
m,g,r,p,e,s,k,f,l,b,c,d,h,t,a,n,w,D,u,F,v,x,y,H,I,G,Ba,N,X){function S(a){return t({url:M.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function P(a,b){var c={f:"json"};b&&(c.token=b);return t({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function C(a){if(a.layerDefinition&&(!a.layerDefinition.drawingInfo||!a.layerDefinition.drawingInfo.labelingInfo))a.showLabels=!1;a.itemProperties.layerDefinition&&
(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),h.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),h.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),h.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):
a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);h.isDefined(a.itemProperties.showLabels)&&!h.isDefined(a.showLabels)&&(a.showLabels=a.itemProperties.showLabels);h.isDefined(a.itemProperties.showLegend)&&!h.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);h.isDefined(a.itemProperties.refreshInterval)&&!h.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}
function A(a){C(a);a.itemProperties.layerDefinition&&a.layerDefinition&&(!h.isDefined(a.layerDefinition.maximumTrackPoints)&&h.isDefined(a.itemProperties.layerDefinition.maximumTrackPoints)&&(a.layerDefinition.maximumTrackPoints=a.itemProperties.layerDefinition.maximumTrackPoints),!a.layerDefinition.definitionGeometry&&a.itemProperties.layerDefinition.definitionGeometry&&(a.layerDefinition.definitionGeometry=a.itemProperties.layerDefinition.definitionGeometry));a.itemProperties.purgeOptions&&!a.purgeOptions&&
(a.purgeOptions=a.itemProperties.purgeOptions)}function z(a,b){var c=new p,d=a.itemData,e=[],k=[];g.forEach(d.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(k.push(a),e.push(S(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!h.isDefined(a.minScale)&&!h.isDefined(a.maxScale))?(k.push(a),e.push(S(a))):-1<b.indexOf("/imageserver")&&!h.isDefined(a.minScale)&&!h.isDefined(a.maxScale)?
(k.push(a),e.push(S(a))):-1<b.indexOf("/streamserver")&&(k.push(a),e.push(S(a)))}});d.baseMap&&d.baseMap.baseMapLayers&&g.forEach(d.baseMap.baseMapLayers,function(a){a.itemId&&"VectorTileLayer"!==a.layerType&&(k.push(a),e.push(S(a)))});if(0<e.length){var m={};(new f(e)).addCallback(function(b){g.forEach(k,function(a,c){var d=b[c][1];if(d&&!(d instanceof Error)&&(m[a.itemId]=d,!a.type)){var e=a.url.toLowerCase();if((-1<e.indexOf("/featureserver")||-1<e.indexOf("/mapserver/"))&&d.layers)g.forEach(d.layers,
function(b){if(e.match("/featureserver/"+b.id+"$")=="/featureserver/"+b.id||e.match("/mapserver/"+b.id+"$")=="/mapserver/"+b.id)a.itemProperties=b,C(a)});else if(-1<e.indexOf("/streamserver"))a.itemProperties=d,A(a);else if(-1<e.indexOf("/mapserver"))d.layers&&!a.layers&&(a.layers=d.layers),h.isDefined(d.minScale)&&!h.isDefined(a.minScale)&&(a.minScale=d.minScale),h.isDefined(d.maxScale)&&!h.isDefined(a.maxScale)&&(a.maxScale=d.maxScale),h.isDefined(d.refreshInterval)&&!h.isDefined(a.refreshInterval)&&
(a.refreshInterval=d.refreshInterval),d.visibleLayers&&!a.visibleLayers&&(a.visibleLayers=d.visibleLayers);else if(-1<e.indexOf("/imageserver")&&(h.isDefined(d.minScale)&&!h.isDefined(a.minScale)&&(a.minScale=d.minScale),h.isDefined(d.maxScale)&&!h.isDefined(a.maxScale)&&(a.maxScale=d.maxScale),h.isDefined(d.refreshInterval)&&!h.isDefined(a.refreshInterval)&&(a.refreshInterval=d.refreshInterval),d.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=d.popupInfo),d.renderingRule&&!a.renderingRule&&
(a.renderingRule=d.renderingRule,d.renderingRule.functionName&&(a.renderingRule.rasterFunction=d.renderingRule.functionName)),d.bandIds&&!a.bandIds&&(a.bandIds=d.bandIds),d.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=d.mosaicRule),d.format&&!a.format&&(a.format=d.format),h.isDefined(d.compressionQuality)&&!h.isDefined(a.compressionQuality)&&(a.compressionQuality=d.compressionQuality),d.layerDefinition&&d.layerDefinition.definitionExpression&&(!h.isDefined(a.layerDefinition)||!h.isDefined(a.layerDefinition.definitionExpression))))a.layerDefinition=
a.layerDefinition||{},a.layerDefinition.definitionExpression=d.layerDefinition.definitionExpression}});a.relatedItemsData=m;c.callback(a)})}else c.callback(a);return c}function Q(a,b){var d=new p,e=a.itemData,f=e.baseMap.baseMapLayers[0];if("BingMapsAerial"===f.type||"BingMapsRoad"===f.type||"BingMapsHybrid"===f.type)if(f.portalUrl&&c.id)delete b.bingMapsKey,c.id.checkSignInStatus(w.urlToObject(M.arcgisUrl).path).then(m.hitch(null,function(a,b,c,d,e){P(f.portalUrl,e.token).then(m.hitch(null,B,a,b,
c,d),m.hitch(null,J,a,b,c,d))},a,b,e,d),m.hitch(null,function(a,b,c,d,e){P(f.portalUrl).then(m.hitch(null,B,a,b,c,d),m.hitch(null,J,a,b,c,d))},a,b,e,d));else if(b.bingMapsKey){var g=new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL});r.connect(g,"onLoad",m.hitch(this,function(){d.callback([a,b])}));r.connect(g,"onError",function(c){delete b.bingMapsKey;a.itemData=T(e);f=a.itemData.baseMap.baseMapLayers[0];f.errors=[];f.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});
d.callback([a,b])})}else a.itemData=T(e),f=a.itemData.baseMap.baseMapLayers[0],f.errors=[],f.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),d.callback([a,b]);else d.callback([a,b]);return d}function E(a){var b=new p,c,d;a=a.itemData;var e=a.baseMap&&a.baseMap.baseMapLayers;if(ja&&!ja.supported())for(a=0;a<e.length;a++){var f=e[a];if(!f.isReference){"VectorTileLayer"===f.layerType&&(c=f.itemId,d=a);break}}c?
Ga(c,!1).addBoth(function(a){var c=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;a&&(a.item&&c.test(a.item.url))&&(e[d]={id:"FB_"+f.id,layerType:"ArcGISTiledMapServiceLayer",opacity:"opacity"in f?f.opacity:1,visibility:"visibility"in f?f.visibility:!0,url:"http://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});b.resolve()}):b.resolve();return b}function B(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new V({bingMapsKey:b.bingMapsKey,
mapStyle:V.MAP_STYLE_AERIAL}),r.connect(e,"onLoad",m.hitch(this,function(){d.callback([a,b])})),r.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=T(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])})):J(a,b,c,d)}function J(a,b,c,d){delete b.bingMapsKey;a.itemData=T(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});
d.callback([a,b])}function T(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",
baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function O(a,b,c,d){var e=a.dynamicLayerInfos||a.layerInfos,f=b.layers;if(f&&e)if(d.usePopupManager){var k;g.forEach(e,function(a){var b=a.id;if(!a.subLayerIds)for(a=
0;a<f.length;a++){var d=f[a];if(d.id===b&&d.popupInfo){k||(k={});k[b]={infoTemplate:new c(d.popupInfo),layerUrl:d.layerUrl};break}}});k&&a.setInfoTemplates(k)}else{var m=[],l=[],n=[],q=[],p=[],r=[];g.forEach(e,function(b){var c=b.id;if(!b.subLayerIds&&-1!==g.indexOf(a.visibleLayers,c))for(b=0;b<f.length;b++){var d=f[b];if(d.id===c){l.push(c);m.push(d.popupInfo);n.push(d.layerUrl||"");d.layerDefinition&&d.layerDefinition.definitionExpression?q.push(d.layerDefinition.definitionExpression):q.push("");
p.push(h.isDefined(d.minScale)?d.minScale:null);r.push(h.isDefined(d.maxScale)?d.maxScale:null);break}}});m.length&&(a.__popups=m,a.__popupIds=l,a.__popupUrls=n,a.__popupWhereClauses=q,a.__popupMinScales=p,a.__popupMaxScales=r,a.__resourceInfo=b.resourceInfo)}}function R(a){if(!a)return!1;var b=(new s(M.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function U(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function L(a){if("https:"===
location.protocol&&(R(a)||U(a)))a=a.replace("http:","https:");return a}function aa(a,b,c){var d=[],e;a.displayLevels||(d=g.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=m.clone(a.exclusionAreas),e=g.map(e,function(a){a.geometry=new u(a.geometry);return a}));d=new Ba(L(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});
c.ignorePopups||O(d,a,b,c);return d}function ba(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function da(a,b,c){var d=new $a;d.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&
(d.format="png32");var d=new ab(L(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var f="";g.forEach(d.layerInfos,function(a){a.defaultVisibility&&(f+=(0<f.length?",":"")+a.id)});e=f}if(a.layers&&0<a.layers.length){var h=[],k=[],l,n=[],q,p;g.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(h[b.id]=
b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){l=null;p=b.layerDefinition.source;if("mapLayer"===p.type){var c=g.filter(a.resourceInfo.layers,function(a){return a.id===p.mapLayerId});c.length&&(l=m.mixin(c[0],b))}else l=m.mixin({},b);l&&(l.source=p,delete l.popupInfo,l=new bb(l),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<g.indexOf(c,b.id)?l.defaultVisibility=!0:l.defaultVisibility=!1),k.push(l))}b.layerDefinition&&
(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(q=new cb(b.layerDefinition.drawingInfo),n[b.id]=q)},this);0<h.length&&d.setLayerDefinitions(h);0<k.length?(d.setDynamicLayerInfos(k,!0),0<n.length&&d.setLayerDrawingOptions(n,!0)):(e=ba(d.layerInfos,e),d.setVisibleLayers(e))}else e=ba(d.layerInfos,e),d.setVisibleLayers(e);c.ignorePopups||O(d,a,b,c);return d}function Ca(a,b,c){var d=new db;d.bandIds=a.bandIds;null!=a.format&&(d.format=a.format,null!=a.compressionQuality&&(d.compressionQuality=
a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var e=new eb(a.renderingRule);d.renderingRule=e}a.mosaicRule&&(e=new fb(a.mosaicRule),d.mosaicRule=e);h.isDefined(a.noData)&&(d.noData=a.noData);h.isDefined(a.noDataInterpretation)&&(d.noDataInterpretation=a.noDataInterpretation);h.isDefined(a.interpolation)&&(d.interpolation=a.interpolation);e=a.layerType?"ArcGISImageServiceVectorLayer"===a.layerType:!1;h.isDefined(a.layerType)||(e=a.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===
a.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===a.resourceInfo.serviceDataType));d={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval};d=e?new gb(L(a.url),d):new hb(L(a.url),d);a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(e=x.fromJson(a.layerDefinition.drawingInfo.renderer),d.setRenderer(e)),a.layerDefinition.definitionExpression&&
d.setDefinitionExpression(a.layerDefinition.definitionExpression,!0));!c.ignorePopups&&a.popupInfo&&d.setInfoTemplate(new b(a.popupInfo));return d}function Y(b,c,d){var e=[102113,102100,3857],f=d||new a(c[0].layerObject.fullExtent.spatialReference),k=new a(b.resourceInfo.fullExtent.spatialReference);return f.wkt==k.wkt&&(f.wkid==k.wkid||h.isDefined(f.latestWkid)&&f.latestWkid==k.wkid||h.isDefined(k.latestWkid)&&f.wkid==k.latestWkid||h.isDefined(f.latestWkid)&&f.latestWkid==k.latestWkid)||f.wkid&&
k.wkid&&g.some(e,function(a){return a===k.wkid})&&g.some(e,function(a){return a===f.wkid})?!0:!1}function ca(a,b,c){if(!b[0].layerObject.tileInfo)return!1;a=a.resourceInfo.tileInfo;b=b[0].layerObject.tileInfo;c=c.width>c.height?c.width:c.height;for(var d=!1,e=!1,f=0;f<a.lods.length;f++){for(var g=a.lods[f].scale/a.dpi,h=0;h<b.lods.length;h++){var k=b.lods[h].scale/b.dpi;if(Math.abs(k-g)/k<1/c)if(d){e=!0;break}else d=!0}if(e)break}return e||d&&(1===a.lods.length||1===b.lods.length)?!0:!1}function ea(b,
d,f,l,n,q){var p,s,t=f._clazz;if("OpenStreetMap"===b.type)p=new ib({id:b.id,opacity:b.opacity,visible:null!==b.visibility&&void 0!==b.visibility?b.visibility:!0});else if("WFS"===b.type)l={customParameters:b.wfsInfo.customParameters,geometryType:b.layerDefinition.geometryType,id:b.id,labelingInfo:b.layerDefinition.drawingInfo.labelingInfo,maxFeatures:b.wfsInfo.maxFeatures,mode:b.mode,name:b.wfsInfo.name,showLabels:!0,swapXY:b.wfsInfo.swapXY,title:b.title,url:b.url,version:b.wfsInfo.version,visible:b.visibility,
wkid:b.layerDefinition.spatialReference.wkid},p=new jb,p.fromJson(l,function(){h.isDefined(b.opacity)&&p.setOpacity(b.opacity);h.isDefined(b.visibility)&&p.setVisibility(b.visibility);(b.minScale||b.maxScale)&&p.setScaleRange(b.minScale,b.maxScale);p.renderer=x.fromJson(b.layerDefinition.drawingInfo.renderer);!f.ignorePopups&&b.popupInfo&&p.setInfoTemplate(new t(b.popupInfo));p.emit("fromJsonComplete")});else if("WMS"===b.type){var Fa=[],Za=[];g.forEach(b.layers,function(a){Za.push(new kb({name:a.name,
title:a.title,legendURL:a.legendURL,queryable:a.queryable,showPopup:a.showPopup}));Fa.push(a.name)},this);b.visibleLayers&&(Fa=b.visibleLayers);l=new u(b.extent[0][0],b.extent[0][1],b.extent[1][0],b.extent[1][1],new a({wkid:4326}));l={customLayerParameters:b.customLayerParameters,customParameters:b.customParameters,extent:l,layerInfos:Za,version:b.version,maxWidth:b.maxWidth,maxHeight:b.maxHeight,featureInfoFormat:b.featureInfoFormat,getFeatureInfoURL:b.featureInfoUrl,getMapURL:b.mapUrl,spatialReferences:b.spatialReferences,
title:b.title,copyright:b.copyright,minScale:b.minScale||0,maxScale:b.maxScale||0,format:b.format};p=new lb(b.url,{id:b.id,visibleLayers:Fa,format:"png",transparent:b.firstLayer?!1:!0,opacity:b.opacity,visible:null!==b.visibility?b.visibility:!0,resourceInfo:l,refreshInterval:b.refreshInterval});p.spatialReference.wkid=l.spatialReferences[0]}else if("KML"===b.type){s=b.url;if(c.id){var $=c.id.findCredential(w.urlToObject(M.arcgisUrl).path);$&&(d=M.arcgisUrl.substring(M.arcgisUrl.indexOf("//")+2,M.arcgisUrl.indexOf("/",
M.arcgisUrl.indexOf("//")+3)),n=d.split("."),n=n[n.length-2]+"."+n[n.length-1],q=s.indexOf(n),-1<q&&(s="https://"+d+s.substring(q+n.length),s+="?token\x3d"+$.token))}p=new mb(s,{id:b.id,visible:null!==b.visibility?b.visibility:!0,outSR:l,refreshInterval:b.refreshInterval});r.connect(p,"onLoad",function(){(b.opacity||0===b.opacity)&&p.setOpacity(b.opacity);h.isDefined(b.minScale)&&h.isDefined(b.maxScale)&&p.setScaleRange(b.minScale,b.maxScale);b.visibleFolders&&g.forEach(p.folders,function(a){-1<g.indexOf(b.visibleFolders,
a.id)?p.setFolderVisibility(a,!0):p.setFolderVisibility(a,!1)},this)})}else"WebTiledLayer"===b.type?(p=new nb(b.templateUrl,{id:b.id,visible:null!==b.visibility?b.visibility:!0,opacity:b.opacity,copyright:b.copyright,fullExtent:b.fullExtent&&new u(b.fullExtent),initialExtent:b.fullExtent&&new u(b.fullExtent),subDomains:b.subDomains,tileInfo:b.tileInfo?new ob(b.tileInfo):null,refreshInterval:b.refreshInterval,wmtsInfo:b.wmtsInfo}),r.connect(p,"onLoad",function(){(h.isDefined(b.minScale)||h.isDefined(b.maxScale))&&
p.setScaleRange(b.minScale,b.maxScale)})):"GeoRSS"===b.type?(p=new pb(b.url,{id:b.id,opacity:b.opacity,outSpatialReference:l,refreshInterval:b.refreshInterval}),r.connect(p,"onLoad",function(){!1===b.visibility&&p.hide();h.isDefined(b.minScale)&&h.isDefined(b.maxScale)&&p.setScaleRange(b.minScale,b.maxScale);var a=p.getFeatureLayers();g.forEach(a,function(c){b.pointSymbol&&"esriGeometryPoint"===c.geometryType?(c.renderer.symbol=v.fromJson(b.pointSymbol),1===a.length&&(p.pointSymbol=v.fromJson(b.pointSymbol))):
b.lineSymbol&&"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=v.fromJson(b.lineSymbol),1===a.length&&(p.polylineSymbol=v.fromJson(b.lineSymbol))):b.polygonSymbol&&"esriGeometryPolygon"===c.geometryType&&(c.renderer.symbol=v.fromJson(b.polygonSymbol),1===a.length&&(p.polygonSymbol=v.fromJson(b.polygonSymbol)))})})):"CSV"==b.type&&b.url?(l={layerDefinition:b.layerDefinition,columnDelimiter:b.columnDelimiter,id:b.id?b.id:null,visible:null!==b.visibility?b.visibility:!0,opacity:b.opacity,refreshInterval:b.refreshInterval},
b.locationInfo&&(l.latitudeFieldName=b.locationInfo.latitudeFieldName,l.longitudeFieldName=b.locationInfo.longitudeFieldName),f.ignorePopups||(l.infoTemplate=new y(b.popupInfo?b.popupInfo:qb.generateDefaultPopupInfo(b))),p=new rb(b.url,l)):"VectorTileLayer"===b.layerType&&b.styleUrl?p=new ja(b.styleUrl,{id:b.id,minScale:b.minScale,maxScale:b.maxScale,opacity:b.opacity,visible:b.visibility}):b.layerDefinition&&!b.url?(l=e.fromJson(e.toJson(b)),delete l.id,delete l.opacity,delete l.visibility,p=new N(l,
{id:b.id,opacity:b.opacity,visible:b.visibility,outFields:["*"],autoGeneralize:!0}),!f.ignorePopups&&l.popupInfo&&p.setInfoTemplate(new t(l.popupInfo)),Oa(p)):"BingMapsAerial"===b.type||"BingMapsRoad"===b.type||"BingMapsHybrid"===b.type?f.bingMapsKey?(l=V.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===b.type?l=V.MAP_STYLE_AERIAL:"BingMapsRoad"===b.type&&(l=V.MAP_STYLE_ROAD),p=new V({bingMapsKey:f.bingMapsKey,mapStyle:l,opacity:b.opacity,id:b.id}),r.connect(p,"onError",m.hitch(this,function(a){a.errors=
a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},b))):(b.errors=b.errors||[],b.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+b.type+"]"})):b.resourceInfo&&b.resourceInfo.mapName?p=!0===b.resourceInfo.singleFusedMapCache&&(b.baseMapLayer||Y(b,d,l)&&ca(b,n,q))?aa(b,t,f):da(b,t,f):b.resourceInfo&&b.resourceInfo.pixelSizeX?
p=!0===b.resourceInfo.singleFusedMapCache&&(b.baseMapLayer||Y(b,d,l)&&ca(b,n,q))?aa(b,t,f):Ca(b,t,f):b.resourceInfo&&"Feature Layer"===b.resourceInfo.type?(b.capabilities&&(b.resourceInfo.capabilities=b.capabilities),p=new N(L(b.url),{resourceInfo:b.resourceInfo,opacity:b.opacity,visible:b.visibility,id:b.id,mode:b.mode===N.MODE_SELECTION?N.MODE_SELECTION:N.MODE_AUTO,editable:!1===f.editable?!1:void 0,outFields:["*"],autoGeneralize:!0,refreshInterval:b.refreshInterval}),!f.ignorePopups&&b.popupInfo&&
p.setInfoTemplate(new t(b.popupInfo)),b.layerDefinition&&(b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.renderer&&(l=x.fromJson(b.layerDefinition.drawingInfo.renderer),l.isMaxInclusive=!0,p.setRenderer(l)),b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.labelingInfo&&(l=g.map(b.layerDefinition.drawingInfo.labelingInfo,function(a){return new sb(a)}),p.setLabelingInfo(l)),b.layerDefinition.definitionExpression&&p.setDefinitionExpression(b.layerDefinition.definitionExpression),
h.isDefined(b.layerDefinition.minScale)&&p.setMinScale(b.layerDefinition.minScale),h.isDefined(b.layerDefinition.maxScale)&&p.setMaxScale(b.layerDefinition.maxScale)),Oa(p)):b.resourceInfo&&b.resourceInfo.streamUrls&&(l={resourceInfo:b.resourceInfo,opacity:b.opacity,visible:b.visibility,id:b.id},b.layerDefinition&&($=b.layerDefinition.drawingInfo,b.layerDefinition.definitionGeometry&&(s=s||{},s.geometry=b.layerDefinition.definitionGeometry),h.isDefined(b.layerDefinition.definitionExpression)&&(s=
s||{},s.where=b.layerDefinition.definitionExpression),h.isDefined(b.layerDefinition.maximumTrackPoints)&&(l.maximumTrackPoints=b.layerDefinition.maximumTrackPoints)),s&&(l.filter=s),b.purgeOptions&&(l.purgeOptions=b.purgeOptions),p=new tb(L(b.url),l),$&&$.renderer&&(l=$.renderer,p.setRenderer(x.fromJson(l))),!f.ignorePopups&&b.popupInfo&&p.setInfoTemplate(new t(b.popupInfo)),b.layerDefinition&&(h.isDefined(b.layerDefinition.minScale)&&p.setMinScale(b.layerDefinition.minScale),h.isDefined(b.layerDefinition.maxScale)&&
p.setMaxScale(b.layerDefinition.maxScale)),k.once(p,"error",function(a){b.errors.push({message:"Error loading stream layer. Check websocket url"})}));p&&(p.arcgisProps={title:b.title},b.baseMapLayer&&(b.isReference?(p.attr("data-reference",!0),p._basemapGalleryLayerType="reference"):p._basemapGalleryLayerType="basemap"));return p}function K(a,b,c,d,e){g.forEach(a,function(f){f.layerObject=ea(f,a,b,c,d,e)});var f=g.filter(a,function(a){return!a.isReference}),h=g.filter(a,function(a){return!!a.isReference});
return a=f.concat(h)}function Da(b){var c=null;b=b[0];b.url&&!b.type?b.resourceInfo.spatialReference&&(c=new a,b.resourceInfo.spatialReference.wkid&&(c.wkid=b.resourceInfo.spatialReference.wkid),b.resourceInfo.spatialReference.wkt&&(c.wkt=b.resourceInfo.spatialReference.wkt)):b.type&&(-1<b.type.indexOf("BingMaps")||"OpenStreetMap"==b.type?c=new a({wkid:102100}):"WMS"==b.type&&(c=new a({wkid:b.spatialReferences[0]})));return c}function Na(a,b,c,d,e,f,h,k){g.forEach(b,function(b){b.url&&!b.type&&(b.resourceInfo=
a[b.deferredsPos][1],delete b.deferredsPos)});f=f||Da(b);b=K(b,c,f,h,k);e.callback(b);return e}function Oa(a){!window.CanvasRenderingContext2D&&(a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass)&&a.setRenderer(x.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:0.75,type:"esriSLS",style:"esriSLSSolid"}}}))}function Pa(a,b){var c=L(a);return t({url:c,content:{f:"json"},
callbackParamName:"callback",error:function(a,e){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);d.defaults.io.errorHandler(a,e)}})}function Qa(a){var b=M.arcgisUrl+"/"+a.itemId+"/data";return t({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,e){c.message=c.message?c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);d.defaults.io.errorHandler(c,e)}})}function Ra(a,b,c){var d=new p;if((!c.featureCollection||!c.featureCollection.layers)&&
!c.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),d.errback(),d;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,h.isDefined(c.showLegend)&&(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));Sa(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?g.forEach(c.featureCollection.layers,
function(b,c){var d=a.featureCollection.layers[c];if(!d.popupInfo&&!d.layerDefinition)d.popupInfo=b.popupInfo,d.layerDefinition=b.layerDefinition;else if(d.layerDefinition){if(h.isDefined(d.layerDefinition.minScale)&&h.isDefined(d.layerDefinition.maxScale)&&(d.layerDefinition.minScale!==b.layerDefinition.minScale||d.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minScale,delete b.layerDefinition.maxScale;d.layerDefinition.drawingInfo&&e.toJson(d.layerDefinition.drawingInfo)!==
e.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;d.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;d.layerDefinition=m.mixin(d.layerDefinition,b.layerDefinition)}else d.layerDefinition=b.layerDefinition;d.featureSet=b.featureSet;d.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=m.mixin(a.featureCollection,c.featureCollection));d.callback(a)});return d}function Sa(a,b,c){var d=
new p;q(["./csv"],function(e){var k=[];g.forEach(b.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=k.length,k.push(e.projectFeatureCollection(a,c,a.featureSet.features[0].geometry.spatialReference)))});(new f(k)).addCallback(function(){g.forEach(b.layers,function(b){h.isDefined(b.deferredsPos)&&(k[b.deferredsPos].results&&k[b.deferredsPos].results.length?b=
k[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});d.callback(b)})});return d}function fa(a,b,c,d,e){var h=new p,l=new p,n=[],r;g.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&n.push(Qa(a).then(m.hitch(null,Ra,a,c)))});0===n.length?Ta(a,
b,c,d,l,e):(r=new f(n),r.addCallback(function(f){Ta(a,b,c,d,l,e)}));l.then(function(a){n=[];g.forEach(a,function(a){var b;a=a.layerObject;a instanceof N&&!a.loaded&&!a.loadError?(b=new p,k.once(a,"load, error",function(){b.callback(a)}),n.push(b)):a&&("esri.layers.WFSLayer"===a.declaredClass&&!a.loadError)&&(b=new p,k.once(a,"fromJsonComplete, error",function(c){b.callback(a)}),n.push(b))});if(n.length){var b=new p;r=new f(n);r.addCallback(function(){b.callback(a)});return b.promise}return a}).then(function(a){var b=
[];g.forEach(a,function(a){var c=a.layerObject;c instanceof N?c.loaded&&(c.labelingInfo&&(a.showLabels||c._collection))&&b.push(c):c&&"esri.layers.WFSLayer"===c.declaredClass&&c.loaded&&c.labelingInfo&&b.push(c)});b.length?q(["../layers/LabelLayer"],function(c){var d=new c;g.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});h.callback(a)}):h.callback(a)});return h}function Ta(a,b,c,d,e,h){var k=[],l=[],m=[];g.forEach(a.operationalLayers,function(a,b){if(a.featureCollection&&a.featureCollection.layers){var c=
a.featureCollection.layers.length;g.forEach(a.featureCollection.layers,function(d,e){var f=!0;a.visibleLayers&&-1==g.indexOf(a.visibleLayers,e)&&(f=!1);d.visibility=a.visibility&&f;d.opacity=a.opacity;d.id=(a.id||"operational"+b)+"_"+e;a.title&&(d.title=1===c||!d.layerDefinition.name||a.title===d.layerDefinition.name?a.title:a.title+" - "+d.layerDefinition.name);m.push(d)},this)}else m.push(a)});g.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;k.push(a)});g.forEach(m,
function(a,b){a.id=a.id||"operational"+b;k.push(a)});g.forEach(k,function(a){a.url&&!a.type&&(a.deferredsPos=l.length,a.errors=a.errors||[],l.push(Pa(a.url,a.errors)))});0===l.length?(c=c||Da(k),k=K(k,b,c,d,h),e.callback(k)):(new f(l)).addCallback(function(a){Na(a,k,b,l,e,c,d,h)});return e}function ga(a,b,c,d){var e=a.minScale,f=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&
(e=Math.min(e,b[a].minScale)),f=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,f),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(g.forEach(a.layerInfos,function(a){a.id==d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),f=Math.max(f||0,a.maxScale||0))}),c.setScaleRange(e,f))}function ha(a,b,c,d){var e=a.url,f=a.__popupIds,k=a.__popupUrls,l=a.__popupWhereClauses,n=a.__popupMinScales,p=a.__popupMaxScales,q=
a.__resourceInfo,s=[];g.forEach(a.__popups,function(d,m){if(d){var t,u=[];g.forEach(d.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var Z=g.filter(a.dynamicLayerInfos,function(a){return f[m]==a.id})[0].source;t=new N(e+"/dynamicLayer",{id:a.id+"_"+f[m],source:Z,outFields:u,mode:N.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,autoGeneralize:!0});var v=function(c,d){0<l[c].length&&d.setDefinitionExpression(l[c]);
if(!h.isDefined(n[c])&&!h.isDefined(p[c]))ga(a,b||q.layers,d,f[c]);else if(h.isDefined(a.minScale)||h.isDefined(a.maxScale)){var e=a.minScale,g=a.maxScale;0==e&&0<n[c]?e=n[c]:0<e&&0==n[c]||0<e&&0<n[c]&&(e=Math.min(e,n[c]));g=Math.max(g||0,p[c]||0);d.setScaleRange(e,g)}else d.setScaleRange(n[c],p[c])};t.loaded?v(m,t):r.connect(t,"onLoad",function(a){v(m,t)})}else{var w=null,x=e+"/"+f[m];if(k[m].length)x=k[m];else if(b)for(Z=0;Z<b.length;Z++)if(b[Z].id===f[m]){w=b[Z];break}t=new N(L(x),{id:a.id+"_"+
f[m],outFields:u,mode:N.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,resourceInfo:w,autoGeneralize:!0});t.loaded?(0<l[m].length&&t.setDefinitionExpression(l[m]),ga(a,b||q.layers,t,f[m])):r.connect(t,"onLoad",function(c){0<l[m].length&&t.setDefinitionExpression(l[m]);ga(a,b||q.layers,c,f[m])})}s.push(t)}});0<s.length&&(r.connect(a,"onVisibilityChange",m.hitch(this,function(a,b){g.forEach(a,function(a){b?a.show():a.hide()})},s)),r.connect(d,"onLayerRemove",m.hitch(this,function(a,
b,c){a.id===c.id&&g.forEach(b,function(a){d.removeLayer(a)})},a,s)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return s}function Ua(a){return t({url:L(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Va(a,b,c){var d=[];g.forEach(a,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=d.length,d.push(Ua(a)))});
var e=[];0<d.length?(new f(d)).addCallback(function(d){g.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(e=e.concat(ha(a,d[a.__deferredsPos][1].layers,c,b)),delete a.__deferredsPos):e=e.concat(ha(a,null,c,b)))});b.addLayers(e)}):(g.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(e=e.concat(ha(a,null,c,b)))}),b.addLayers(e))}function Wa(a){g.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&(b.name&&-1<b.name.indexOf("Text"))&&
g.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Xa(a){var b=6;g.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===
a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&g.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function Ea(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var e=[];g.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&a instanceof N&&a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a)});g.forEach(b.layerIds,
function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;if(e.length||d){var f=Xa(e),h=a.screenPoint,k=b.toMap(new D(h.x-f,h.y+f)),f=b.toMap(new D(h.x+f,h.y-f)),k=new u(k.x,k.y,f.x,f.y,b.spatialReference),l=new I;l.geometry=k;l.timeExtent=b.timeExtent;var m=!0,k=g.map(e,function(b){var c;-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(l.geometry=a.mapPoint,m=!1,c=b.queryVisibleRasters(l,
{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(l),c.addCallback(function(){return b.getSelectedFeatures()}));return c});d&&(f=new p,f.callback([d]),k.splice(0,0,f));if(!g.some(k,function(a){return-1===a.fired})){var n=d?1:0;g.forEach(e,function(a){n=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?n+a.getVisibleRasters().length:n+a.getSelectedFeatures().length});if(!n)return}c.setFeatures(k);c.show(a.mapPoint,
{closestFirst:m})}}}function wb(a,b){var c=b.mapOptions||{},d;c.infoWindow||(d=new H({visibleWhenEmpty:!1},l.create("div")),c.infoWindow=d);!h.isDefined(c.showInfoWindowOnClick)&&!b.usePopupManager&&(c.showInfoWindowOnClick=!1);c=new n(a,c);r.connect(c,"onLayersAddResult",Wa);return c}function W(a,b,c,d,e,f){var h,k,l,m;d.map?(h=d.map,k=d.clickEventHandle,l=d.clickEventListener,m=d.errors):(h=wb(d,e),!e.ignorePopups&&(!e.disableClickBehavior&&!e.usePopupManager)&&(k=r.connect(h,"onClick",Ea),l=Ea));
h.addLayers(a);!e.ignorePopups&&!e.usePopupManager&&Va(a,h,e._clazz);var n=m||[];g.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);h.loaded?f.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l}):r.connect(h,"onLoad",function(){f.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l})})}function ia(a,b,c,d,e){var f=[];g.forEach(e,function(a){m.isArray(a.layerObject)?g.forEach(a.layerObject,function(a){f.push(a)}):f.push(a.layerObject)});
if("BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var h=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(h),Ya(a,b,c,d,e,f);else if(e[0].errors){clearInterval(h);var g="";e[0].errors&&e[0].errors.length&&(g=" ("+e[0].errors[0].message+")");d.errback(Error(X.arcgis.utils.baseLayerError+g))}},10);else if(!f[0]&&e[0].baseMapLayer){var k="";e[0].errors&&e[0].errors.length&&(k=" ("+e[0].errors[0].message+")");d.errback(Error(X.arcgis.utils.baseLayerError+
k))}else Ya(a,b,c,d,e,f)}function Ya(b,c,e,f,k,l){try{var m=e.mapOptions||{};e.mapOptions=m;var n=b.item;l=g.filter(l,h.isDefined);if(n)if(n.extent&&n.extent.length)if(m.extent)W(l,k,b,c,e,f);else{var p=new u(n.extent[0][0],n.extent[0][1],n.extent[1][0],n.extent[1][1],new a({wkid:4326})),q=l[0].spatialReference;4326===q.wkid?(m.extent=p,W(l,k,b,c,e,f)):102100===q.wkid||102113===q.wkid||3857===q.wkid?(p.xmin=Math.max(p.xmin,-180),p.xmax=Math.min(p.xmax,180),p.ymin=Math.max(p.ymin,-89.99),p.ymax=Math.min(p.ymax,
89.99),m.extent=F.geographicToWebMercator(p),W(l,k,b,c,e,f)):e.geometryServiceURL||d.defaults.geometryService?(e.geometryServiceURL?new G(e.geometryServiceURL):d.defaults.geometryService).project([p],q,function(a){a=a[0];m.extent=m.extent||a;W(l,k,b,c,e,f)},function(){W(l,k,b,c,e,f)}):f.errback(Error(X.arcgis.utils.geometryServiceError))}else W(l,k,b,c,e,f);else W(l,k,b,c,e,f)}catch(r){f.errback(r)}}function xb(a){var b=[];g.forEach(a.operationalLayers,function(a){a.featureCollection?b.push({featureCollection:a.featureCollection,
visibility:a.visibility,title:a.title}):a.layerObject&&b.push({layer:a.layerObject,visibility:a.visibility,title:a.title})});return b}function ub(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);g.forEach(a,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&g.forEach(a.featureCollection.layers,function(d){if(!1!==d.showLegend){var e=d.layerObject.renderer;c={layer:d.layerObject,title:a.title,defaultSymbol:e&&e.defaultSymbol&&e.defaultLabel?
!0:!1};1<a.featureCollection.layers.length&&(c.title+=" - "+d.layerDefinition.name);b.push(c)}});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject&&!(a.layerObject instanceof N&&a.layerObject.mode===N.MODE_SELECTION)){var d=a.layerObject.renderer,e=a.layerObject.declaredClass,d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===e||"esri.layers.ArcGISTiledMapServiceLayer"===
e)||"esri.layers.ArcGISImageServiceLayer"===e)d=!0;c={layer:a.layerObject,title:a.title,defaultSymbol:d};a.layers&&(e=g.map(g.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),e.length&&(c.hideLayers=e));b.push(c)}});return b}function yb(a,b){function c(a,b){g.forEach(a,function(a,c){switch(a){case ka:ab=b[c];break;case la:hb=b[c];break;case ma:gb=b[c];break;case Ha:qb=b[c];break;case na:rb=b[c];break;case Ia:bb=b[c];break;case oa:pb=b[c];break;case Ja:$a=b[c];break;
case pa:db=b[c];break;case qa:mb=b[c];break;case ra:sb=b[c];break;case Ka:cb=b[c];break;case sa:fb=b[c];break;case ta:ib=b[c];break;case ua:eb=b[c];break;case va:tb=b[c];break;case La:ob=b[c];break;case wa:ja=b[c];break;case xa:V=b[c];break;case ya:nb=b[c];break;case za:jb=b[c];break;case Aa:lb=b[c];break;case Ma:kb=b[c]}})}var d=new p,e=a.itemData,f=[];e.baseMap&&e.baseMap.baseMapLayers&&(f=f.concat(e.baseMap.baseMapLayers));e.operationalLayers&&(f=f.concat(e.operationalLayers));for(var e=g.map(f,
function(a){return a&&a.layerType}),h=[],k=[],f=!1,l=0;l<e.length;l++){switch(e[l]){case "ArcGISFeatureLayer":-1===g.indexOf(h,ra)&&h.push(ra);break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===g.indexOf(h,la)&&(h.push(la),k.push(pa),k.push(sa),k.push(ua));break;case "ArcGISImageServiceVectorLayer":-1===g.indexOf(h,ma)&&(h.push(ma),k.push(pa),k.push(sa),k.push(ua));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===g.indexOf(h,ka)&&(h.push(ka),k.push(Ia),
k.push(Ja),k.push(Ka));break;case "ArcGISStreamLayer":-1===g.indexOf(h,va)&&h.push(va);break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===g.indexOf(h,xa)&&h.push(xa);break;case "CSV":-1===g.indexOf(h,na)&&(h.push(na),k.push(Ha));break;case "GeoRSS":-1===g.indexOf(h,oa)&&h.push(oa);break;case "KML":-1===g.indexOf(h,qa)&&h.push(qa);break;case "OpenStreetMap":-1===g.indexOf(h,ta)&&h.push(ta);break;case "VectorTileLayer":-1===g.indexOf(h,wa)&&h.push(wa);break;case "WebTiledLayer":-1===
g.indexOf(h,ya)&&(h.push(ya),k.push(La));break;case "WFS":-1===g.indexOf(h,za)&&h.push(za);break;case "WMS":-1===g.indexOf(h,Aa)&&(h.push(Aa),k.push(Ma));break;default:f=!0}if(f)break}f&&(h=zb,k=Ab);h.length?q(h,function(){c(h,arguments);k.length?q(k,function(){c(k,arguments);d.resolve()}):d.resolve()}):d.resolve();return d}function vb(a,b,c,d){var e=d.itemData;e.baseMap&&(e.baseMap.baseMapLayers&&e.baseMap.baseMapLayers.length)&&(e.baseMap.baseMapLayers[0].firstLayer=!0);var f=b.layerMixins,h=f&&
f.length;if(h){var k=function(a){for(var b=0;b<h;b++){var c=f[b];if(c.mixin)if(c.hasOwnProperty("id")){if(a.id===c.id){m.mixin(a,c.mixin);break}}else if(a.url===c.url){m.mixin(a,c.mixin);break}}};g.forEach(e.baseMap&&e.baseMap.baseMapLayers,k);g.forEach(e.operationalLayers,k)}yb(d,b).then(function(){return E(d,b)}).then(function(){return Q(d,b)}).then(function(b){var d=b[0],e=b[1];if(!d.itemData.operationalLayers||0===d.itemData.operationalLayers.length)z(d,e).addCallback(function(b){fa(b.itemData,
e).addCallback(m.hitch(null,ia,b,a,e,c))});else{var f=new p,h=d.itemData.baseMap.baseMapLayers.slice(),k=g.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:k}}};d.itemData.baseMap.baseMapLayers=g.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});z(b,e).addCallback(function(b){fa(b.itemData,e).addCallback(m.hitch(null,ia,b,a,e,f))});f.then(function(a){z(d,e).addCallback(function(b){fa(b.itemData,e,a.map.spatialReference,
k,a.map).addCallback(function(d){b.itemData.baseMap.baseMapLayers=h;ia(b,a,e,c,d)})})},m.hitch(c,c.errback))}})}function Ga(a,b){"undefined"===typeof b&&(b=!0);M._arcgisUrl&&0<M._arcgisUrl.length&&(M.arcgisUrl=M._arcgisUrl);var c=M.arcgisUrl+"/"+a,d={},e=new p;t({url:c,content:{f:"json"},callbackParamName:"callback",load:function(a){d.item=a;b?t({url:c+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){d.itemData=a;e.callback(d)},error:function(a){e.errback(a)}}):e.callback(d)},
error:function(a){e.errback(a)}});return e}var M,ab,hb,gb,qb,rb,bb,pb,$a,db,mb,sb,cb,fb,ib,eb,tb,ob,ja,V,nb,jb,lb,kb,ka="../layers/ArcGISDynamicMapServiceLayer",la="../layers/ArcGISImageServiceLayer",ma="../layers/ArcGISImageServiceVectorLayer",Ha="./csv",na="../layers/CSVLayer",Ia="../layers/DynamicLayerInfo",oa="../layers/GeoRSSLayer",Ja="../layers/ImageParameters",pa="../layers/ImageServiceParameters",qa="../layers/KMLLayer",ra="../layers/LabelClass",Ka="../layers/LayerDrawingOptions",sa="../layers/MosaicRule",
ta="../layers/OpenStreetMapLayer",ua="../layers/RasterFunction",va="../layers/StreamLayer",La="../layers/TileInfo",wa="../layers/VectorTileLayer",xa="../virtualearth/VETiledLayer",ya="../layers/WebTiledLayer",za="../layers/WFSLayer",Aa="../layers/WMSLayer",Ma="../layers/WMSLayerInfo",zb=[ka,la,ma,na,oa,qa,ra,ta,va,wa,xa,ya,za,Aa],Ab=[Ha,Ia,Ja,pa,Ka,sa,ua,La,Ma];M={arcgisUrl:w.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:Ga,createMap:function(a,b,c){var d=new p;
c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(m.isObject(e)?e:m.getObject(e))||y;m.isString(a)?Ga(a).addCallback(m.hitch(null,vb,b,c,d)).addErrback(m.hitch(d,d.errback)):vb(b,c,d,a);return d},getLayerList:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?xb(a.itemInfo.itemData):[]},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?ub(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:z,_getItemData:S,_getBingKey:P,_portalUrlResponse:B,_portalUrlFailure:J,_processFSItemProperties:C,
_processSSItemProperties:A,_getLayers:fa,_preBuildLayerObjects:Na,_buildLayerObjects:K,_preCreateMap:ia,_getMapSR:Da,_createMap:W,_addSelectionLayers:Va,_createSelectionFeatureLayers:ha,_getServiceInfo:Pa,_getFeatureCollectionItem:Qa,_mergeFeatureCollectionItem:Ra,_projectFeatureCollection:Sa,_getLayersInfo:Ua,_initLayer:ea,_loadAsCached:aa,_loadAsDynamic:da,_processPopups:O,_onLayersAddResult:Wa,_sameSpatialReferenceAsBasemap:Y,_sameTilingSchemeAsBasemap:ca,_showPopup:Ea,_calculateClickTolerance:Xa,
_getVisibleFeatureLayers:ba,_updateLayerScaleInfo:ga,_checkUrl:L,_isHostedService:R,_isAgolService:U,_getLegendLayers:ub};m.setObject("arcgis.utils",M,c);return M});